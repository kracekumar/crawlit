<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>PEP 338 -- Executing modules as scripts</title>
  <meta name="keywords" content="PEP 338 -- Executing modules as scripts" />
  <meta name="description" content="PEP 338 -- Executing modules as scripts" />
  <link rel="alternate" type="application/rss+xml" title="Community Events"
        href="http://www.python.org/channews.rdf" />
  <link rel="alternate" type="application/rss+xml" title="Python Recipes"
        href="http://aspn.activestate.com/ASPN/Cookbook/Python/index_rss" />
  <link rel="alternate" type="application/rss+xml" title="Usergroup News"
        href="http://python-groups.blogspot.com/feeds/posts/default" />
  <link rel="alternate" type="application/rss+xml" title="Python Screencasts"
        href="http://www.showmedo.com/latestVideoFeed/rss2.0?tag=python" />
  <link rel="alternate" type="application/rss+xml" title="Python Podcasts"
        href="http://www.awaretek.com/python/index.xml" />
  <link rel="alternate" type="application/rss+xml" title="Foundation News"
        href="http://feeds.feedburner.com/PythonSoftwareFoundationNews" />
  <link rel="alternate" type="application/rss+xml" title="Python Enhancement Proposals"
        href="http://www.python.org/dev/peps/peps.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Job Opportunities"
        href="http://www.python.org/community/jobs/jobs.rss" />
  <link rel="alternate" type="application/rss+xml" title="Reddit Feed of Python What's New Online"
        href="http://www.reddit.com/r/Python/.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Insider"
        href="http://feeds.feedburner.com/PythonInsider" />

  <link rel="stylesheet" type="text/css" media="screen" id="screen-switcher-stylesheet"
        href="/styles/screen-switcher-default.css" />
  <link rel="stylesheet" type="text/css" media="sc&#82;een"
        href="/styles/netscape4.css" />
  <link rel="stylesheet" type="text/css" media="print"
        href="/styles/print.css" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/largestyles.css" title="large text" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/defaultfonts.css" title="default fonts" />

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search under the www.python.org Domain"
        href="/search-pysite.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Wiki"
        href="/search-pywiki.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within Python Books at Google Book Search"
        href="/search-pybooks.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Documentation"
        href="/search-pydocs.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for a Module in the Standard Library"
        href="/search-pymodules.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for Packages inside the Cheeseshop (PyPI)"
        href="/search-pycheese.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search Archives of the Main Python Mailing List"
        href="/search-pythonlist.xml"/>

  <script type="text/javascript" src="/js/iotbs2-key-directors-load.js"></script>
  <script type="text/javascript" src="/js/iotbs2-directors.js"></script>
  <script type="text/javascript" src="/js/iotbs2-core.js"></script>

</head>


<body>
  <!-- Logo -->
  <h1 id="logoheader">
    <a href="/" id="logolink" accesskey="1"><img id="logo" src="/images/python-logo.gif" alt="homepage" border="0" /></a>
  </h1>
  <!-- Skip to Navigation -->
  <div class="skiptonav"><a href="#left-hand-navigation" accesskey="2"><img src="/images/trans.gif" id="skiptonav" alt="skip to navigation" border="0" /></a></div>
  <div class="skiptonav"><a href="#content-body" accesskey="3"><img src="/images/trans.gif" id="skiptocontent" alt="skip to content" border="0" /></a></div>
  <!-- Utility Menu -->
  <div id="utility-menu">
    <!-- Search Box -->
    <div id="searchbox">
      <form method="get" action="http://google.com/search" id="searchform" name="searchform">
        <div id="search">
          <input type="hidden" id="domains" name="domains" value="www.python.org" />
          <input type="hidden" id="sitesearch" name="sitesearch" value="www.python.org" />
          <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
          <input type="text" class="input-text" name="q" id="q" />
          <input type="submit" value="search" class="input-button" name="submit" id="submit" />
          <a href="/search" class="reference">Advanced Search</a>
        </div>
      </form>
    </div>
    <div id="screen-switcher"></div>
  </div>

  <div id="left-hand-navigation">
    <!-- Main Menu -->
    <div id="menu">
      <ul class="level-one">
            <li>
          <a href="/about/" title="About The Python Language">About</a>
        </li>
            <li>
          <a href="/news/" title="Major Happenings Within the Python Community">News</a>
        </li>
            <li>
          <a href="/doc/" title="Tutorials, Library Reference, C API">Documentation</a>
        </li>
            <li>
          <a href="/download/" title="Start Running Python Under Windows, Mac, Linux and Others">Download</a>
        </li>
            <li>
          <a href="/getit/" title="Alternate Download page for China">ä¸è½½</a>
        </li>
            <li>
          <a href="/community/" title="Mailing Lists, Jobs, Conferences, SIGs, Online Chats">Community</a>
        </li>
            <li>
          <a href="/psf/" title="Python Software Foundation">Foundation</a>
        </li>
            <li>
          <a href="http://docs.python.org/devguide/" title="Development of the Python language and website">Core Development</a>
        </li>
      </ul>
    </div>

    <!-- Quick Links -->
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/">Python Wiki</a></h4>
    <h4><a style="margin-top:1.5em" href="http://blog.python.org/">Python Insider Blog</a></h4>
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/Python2orPython3">Python 2 or 3?</a></h4>
    <h4><a style="color:#D58228; margin-top:1.5em" href="/psf/donations/">Help Fund Python</a></h4>
    <div style="align:center; padding-top: 0.5em; padding-left: 1em">
      <a href="/psf/donations/"><img width="116" height="42" src="/images/donate.png" alt="" title="" /></a>
    </div>
    <div style="align:center; padding-top: 0.5em; padding-left: 2.5em">
            <a href="http://wiki.python.org/moin/Languages"><img
	      style="align:center"
              width="94" height="46"
	      src="/images/worldmap.jpg" alt="[Python resources in languages other than English]" /></a>
    </div>
    <div style="align:center; padding-top: 0.0em; padding-left: 0em">
       <h4><a href="http://wiki.python.org/moin/Languages">Non-English Resources</a></h4>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Release%20Schedule&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com/public/basic.ics">
                Python Release Schedule iCal Calendar
            </a>
        </iframe>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Events%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com/public/basic.ics">
                Python Events iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=User%20Group%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com&amp;color=%23125A12&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com/public/basic.ics">
                Python User Group iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
  </div>

  <div id="content-body">
    <div id="body-main">
      <div id="content">
        
          <div id="breadcrumb">
               <a href="/dev/peps/">PEP Index</a>
               <span class="breadcrumb-separator">&gt;</span>
            
            PEP 338 -- Executing modules as scripts
          </div>



        <!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">338</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Executing modules as scripts</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">e2b5d1a8a663</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="http://hg.python.org/peps/file/tip/pep-0338.txt">2009-01-18 09:50:42 +0000 (Sun, 18 Jan 2009)</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Nick Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">16-Oct-2004</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.5</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">8-Nov-2004, 11-Feb-2006, 12-Feb-2006, 18-Feb-2006</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id11">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id12">Rationale</a></li>
<li><a class="reference internal" href="#scope-of-this-proposal" id="id13">Scope of this proposal</a></li>
<li><a class="reference internal" href="#current-behaviour" id="id14">Current Behaviour</a></li>
<li><a class="reference internal" href="#proposed-semantics" id="id15">Proposed Semantics</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id16">Reference Implementation</a></li>
<li><a class="reference internal" href="#import-statements-and-the-main-module" id="id17">Import Statements and the Main Module</a></li>
<li><a class="reference internal" href="#resolved-issues" id="id18">Resolved Issues</a></li>
<li><a class="reference internal" href="#alternatives" id="id19">Alternatives</a></li>
<li><a class="reference internal" href="#references" id="id20">References</a></li>
<li><a class="reference internal" href="#copyright" id="id21">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id11">Abstract</a></h1>
<p>This PEP defines semantics for executing any Python module as a
script, either with the <tt class="docutils literal"><span class="pre">-m</span></tt> command line switch, or by invoking
it via <tt class="docutils literal">runpy.run_module(modulename)</tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">-m</span></tt> switch implemented in Python 2.4 is quite limited. This
PEP proposes making use of the <a class="reference external" href="/dev/peps/pep-0302">PEP 302</a> <a class="footnote-reference" href="#id9" id="id1">[4]</a> import hooks to allow any
module which provides access to its code object to be executed.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id12">Rationale</a></h1>
<p>Python 2.4 adds the command line switch <tt class="docutils literal"><span class="pre">-m</span></tt> to allow modules to be
located using the Python module namespace for execution as scripts.
The motivating examples were standard library modules such as <tt class="docutils literal">pdb</tt>
and <tt class="docutils literal">profile</tt>, and the Python 2.4 implementation is fine for this
limited purpose.</p>
<p>A number of users and developers have requested extension of the
feature to also support running modules located inside packages.  One
example provided is pychecker's <tt class="docutils literal">pychecker.checker</tt> module.  This
capability was left out of the Python 2.4 implementation because the
implementation of this was significantly more complicated, and the most
appropriate strategy was not at all clear.</p>
<p>The opinion on python-dev was that it was better to postpone the
extension to Python 2.5, and go through the PEP process to help make
sure we got it right.</p>
<p>Since that time, it has also been pointed out that the current version
of <tt class="docutils literal"><span class="pre">-m</span></tt> does not support <tt class="docutils literal">zipimport</tt> or any other kind of
alternative import behaviour (such as frozen modules).</p>
<p>Providing this functionality as a Python module is significantly easier
than writing it in C, and makes the functionality readily available to
all Python programs, rather than being specific to the CPython
interpreter. CPython's command line switch can then be rewritten to
make use of the new module.</p>
<p>Scripts which execute other scripts (e.g. <tt class="docutils literal">profile</tt>, <tt class="docutils literal">pdb</tt>) also
have the option to use the new module to provide <tt class="docutils literal"><span class="pre">-m</span></tt> style support
for identifying the script to be executed.</p>
</div>
<div class="section" id="scope-of-this-proposal">
<h1><a class="toc-backref" href="#id13">Scope of this proposal</a></h1>
<p>In Python 2.4, a module located using <tt class="docutils literal"><span class="pre">-m</span></tt> is executed just as if
its filename had been provided on the command line.  The goal of this
PEP is to get as close as possible to making that statement also hold
true for modules inside packages, or accessed via alternative import
mechanisms (such as <tt class="docutils literal">zipimport</tt>).</p>
<p>Prior discussions suggest it should be noted that this PEP is <strong>not</strong>
about changing the idiom for making Python modules also useful as
scripts (see <a class="reference external" href="/dev/peps/pep-0299">PEP 299</a> <a class="footnote-reference" href="#id6" id="id2">[1]</a>). That issue is considered orthogonal to the
specific feature addressed by this PEP.</p>
</div>
<div class="section" id="current-behaviour">
<h1><a class="toc-backref" href="#id14">Current Behaviour</a></h1>
<p>Before describing the new semantics, it's worth covering the existing
semantics for Python 2.4 (as they are currently defined only by the
source code and the command line help).</p>
<p>When <tt class="docutils literal"><span class="pre">-m</span></tt> is used on the command line, it immediately terminates the
option list (like <tt class="docutils literal"><span class="pre">-c</span></tt>).  The argument is interpreted as the name of
a top-level Python module (i.e. one which can be found on
<tt class="docutils literal">sys.path</tt>).</p>
<p>If the module is found, and is of type <tt class="docutils literal">PY_SOURCE</tt> or
<tt class="docutils literal">PY_COMPILED</tt>, then the command line is effectively reinterpreted
from <tt class="docutils literal">python &lt;options&gt; <span class="pre">-m</span> &lt;module&gt; &lt;args&gt;</tt> to <tt class="docutils literal">python &lt;options&gt;
&lt;filename&gt; &lt;args&gt;</tt>.  This includes setting <tt class="docutils literal">sys.argv[0]</tt> correctly
(some scripts rely on this - Python's own <tt class="docutils literal">regrtest.py</tt> is one
example).</p>
<p>If the module is not found, or is not of the correct type, an error
is printed.</p>
</div>
<div class="section" id="proposed-semantics">
<h1><a class="toc-backref" href="#id15">Proposed Semantics</a></h1>
<p>The semantics proposed are fairly simple: if <tt class="docutils literal"><span class="pre">-m</span></tt> is used to execute
a module the <a class="reference external" href="/dev/peps/pep-0302">PEP 302</a> import mechanisms are used to locate the module and
retrieve its compiled code, before executing the module in accordance
with the semantics for a top-level module. The interpreter does this by
invoking a new standard library function <tt class="docutils literal">runpy.run_module</tt>.</p>
<p>This is necessary due to the way Python's import machinery locates
modules inside packages.  A package may modify its own __path__
variable during initialisation.  In addition, paths may be affected by
<tt class="docutils literal">*.pth</tt> files, and some packages will install custom loaders on
<tt class="docutils literal">sys.metapath</tt>.  Accordingly, the only way for Python to reliably
locate the module is by importing the containing package and
using the <a class="reference external" href="/dev/peps/pep-0302">PEP 302</a> import hooks to gain access to the Python code.</p>
<p>Note that the process of locating the module to be executed may require
importing the containing package.  The effects of such a package import
that will be visible to the executed module are:</p>
<ul class="simple">
<li>the containing package will be in sys.modules</li>
<li>any external effects of the package initialisation (e.g. installed
import hooks, loggers, atexit handlers, etc.)</li>
</ul>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id16">Reference Implementation</a></h1>
<p>A reference implementation is available on SourceForge (<a class="footnote-reference" href="#id7" id="id3">[2]</a>), along
with documentation for the library reference (<a class="footnote-reference" href="#id10" id="id4">[5]</a>).  There are
two parts to this implementation. The first is a proposed standard
library module <tt class="docutils literal">runpy</tt>. The second is a modification to the code
implementing the <tt class="docutils literal"><span class="pre">-m</span></tt> switch to always delegate to
<tt class="docutils literal">runpy.run_module</tt> instead of trying to run the module directly.
The delegation has the form:</p>
<pre class="literal-block">
runpy.run_module(sys.argv[0], run_name=&quot;__main__&quot;, alter_sys=True)
</pre>
<p><tt class="docutils literal">run_module</tt> is the only function <tt class="docutils literal">runpy</tt> exposes in its public API.</p>
<p><tt class="docutils literal">run_module(mod_name[, <span class="pre">init_globals][,</span> <span class="pre">run_name][,</span> alter_sys])</tt></p>
<blockquote>
<p>Execute the code of the specified module and return the resulting
module globals dictionary. The module's code is first located using
the standard import mechanism (refer to <a class="reference external" href="/dev/peps/pep-0302">PEP 302</a> for details) and
then executed in a fresh module namespace.</p>
<p>The optional dictionary argument <tt class="docutils literal">init_globals</tt> may be used to
pre-populate the globals dictionary before the code is executed.
The supplied dictionary will not be modified. If any of the special
global variables below are defined in the supplied dictionary, those
definitions are overridden by the run_module function.</p>
<p>The special global variables <tt class="docutils literal">__name__</tt>, <tt class="docutils literal">__file__</tt>,
<tt class="docutils literal">__loader__</tt> and <tt class="docutils literal">__builtins__</tt> are set in the globals dictionary
before the module code is executed.</p>
<p><tt class="docutils literal">__name__</tt> is set to <tt class="docutils literal">run_name</tt> if this optional argument is
supplied, and the original <tt class="docutils literal">mod_name</tt> argument otherwise.</p>
<p><tt class="docutils literal">__loader__</tt> is set to the <a class="reference external" href="/dev/peps/pep-0302">PEP 302</a> module loader used to retrieve
the code for the module (This loader may be a wrapper around the
standard import mechanism).</p>
<p><tt class="docutils literal">__file__</tt> is set to the name provided by the module loader. If
the loader does not make filename information available, this
argument is set to <tt class="docutils literal">None</tt>.</p>
<p><tt class="docutils literal">__builtins__</tt> is automatically initialised with a reference to
the top level namespace of the <tt class="docutils literal">__builtin__</tt> module.</p>
<p>If the argument <tt class="docutils literal">alter_sys</tt> is supplied and evaluates to <tt class="docutils literal">True</tt>,
then <tt class="docutils literal">sys.argv[0]</tt> is updated with the value of <tt class="docutils literal">__file__</tt>
and <tt class="docutils literal">sys.modules[__name__]</tt> is updated with a temporary module
object for the module being executed. Both <tt class="docutils literal">sys.argv[0]</tt> and
<tt class="docutils literal">sys.modules[__name__]</tt> are restored to their original values
before this function returns.</p>
</blockquote>
<p>When invoked as a script, the <tt class="docutils literal">runpy</tt> module finds and executes the
module supplied as the first argument.  It adjusts <tt class="docutils literal">sys.argv</tt> by
deleting <tt class="docutils literal">sys.argv[0]</tt> (which refers to the <tt class="docutils literal">runpy</tt> module itself)
and then invokes <tt class="docutils literal">run_module(sys.argv[0], <span class="pre">run_name=&quot;__main__&quot;,</span>
alter_sys=True)</tt>.</p>
</div>
<div class="section" id="import-statements-and-the-main-module">
<h1><a class="toc-backref" href="#id17">Import Statements and the Main Module</a></h1>
<p>The release of 2.5b1 showed a surprising  (although obvious in
retrospect) interaction between this PEP and <a class="reference external" href="/dev/peps/pep-0328">PEP 328</a> - explicit
relative imports don't work from a main module. This is due to
the fact that relative imports rely on <tt class="docutils literal">__name__</tt> to determine
the current module's position in the package hierarchy. In a main
module, the value of <tt class="docutils literal">__name__</tt> is always <tt class="docutils literal">'__main__'</tt>, so
explicit relative imports will always fail (as they only work for
a module inside a package).</p>
<p>Investigation into why implicit relative imports <em>appear</em> to work when
a main module is executed directly but fail when executed using -m
showed that such imports are actually always treated as absolute
imports. Because of the way direct execution works, the package
containing the executed module is added to sys.path, so its sibling
modules are actually imported as top level modules. This can easily
lead to multiple copies of the sibling modules in the application if
implicit relative imports are used in modules that may be directly
executed (e.g. test modules or utility scripts).</p>
<p>For the 2.5 release, the recommendation is to always use absolute
imports in any module that is intended to be used as a main module.
The -m switch provides a benefit here, as it inserts the current
directory into sys.path, instead of the directory contain the main
module. This means that it is possible to run a module from inside a
package using -m so long as the current directory contains the top
level directory for the package. Absolute imports will work correctly
even if the package isn't installed anywhere else on sys.path. If the
module is executed directly and uses absolute imports to retrieve its
sibling modules, then the top level package directory needs to be
installed somewhere on sys.path (since the current directory won't be
added automatically).</p>
<p>Here's an example file layout:</p>
<pre class="literal-block">
devel/
    pkg/
        __init__.py
        moduleA.py
        moduleB.py
        test/
            __init__.py
            test_A.py
            test_B.py
</pre>
<p>So long as the current directory is <tt class="docutils literal">devel</tt>, or <tt class="docutils literal">devel</tt> is already
on <tt class="docutils literal">sys.path</tt> and the test modules use absolute imports (such as
<tt class="docutils literal">import pkg moduleA</tt> to retrieve the module under test, <a class="reference external" href="/dev/peps/pep-0338">PEP 338</a>
allows the tests to be run as:</p>
<pre class="literal-block">
python -m pkg.test.test_A
python -m pkg.test.test_B
</pre>
<p>The question of whether or not relative imports should be supported
when a main module is executed with -m is something that will be
revisited for Python 2.6. Permitting it would require changes to
either Python's import semantics or the semantics used to indicate
when a module is the main module, so it is not a decision to be made
hastily.</p>
</div>
<div class="section" id="resolved-issues">
<h1><a class="toc-backref" href="#id18">Resolved Issues</a></h1>
<p>There were some key design decisions that influenced the development of
the <tt class="docutils literal">runpy</tt> module. These are listed below.</p>
<ul class="simple">
<li>The special variables <tt class="docutils literal">__name__</tt>, <tt class="docutils literal">__file__</tt> and <tt class="docutils literal">__loader__</tt>
are set in a module's global namespace before the module is executed.
As <tt class="docutils literal">run_module</tt> alters these values, it does <strong>not</strong> mutate the
supplied dictionary. If it did, then passing <tt class="docutils literal">globals()</tt> to this
function could have nasty side effects.</li>
<li>Sometimes, the information needed to populate the special variables
simply isn't available. Rather than trying to be too clever, these
variables are simply set to <tt class="docutils literal">None</tt> when the relevant information
cannot be determined.</li>
<li>There is no special protection on the alter_sys argument.
This may result in <tt class="docutils literal">sys.argv[0]</tt> being set to <tt class="docutils literal">None</tt> if file
name information is not available.</li>
<li>The import lock is NOT used to avoid potential threading issues that
arise when alter_sys is set to True. Instead, it is recommended that
threaded code simply avoid using this flag.</li>
</ul>
</div>
<div class="section" id="alternatives">
<h1><a class="toc-backref" href="#id19">Alternatives</a></h1>
<p>The first alternative implementation considered ignored packages'
__path__ variables, and looked only in the main package directory.  A
Python script with this behaviour can be found in the discussion of
the <tt class="docutils literal">execmodule</tt> cookbook recipe <a class="footnote-reference" href="#id8" id="id5">[3]</a>.</p>
<p>The <tt class="docutils literal">execmodule</tt> cookbook recipe itself was the proposed mechanism in
an earlier version of this PEP (before the PEP's author read <a class="reference external" href="/dev/peps/pep-0302">PEP 302</a>).</p>
<p>Both approaches were rejected as they do not meet the main goal of the
<tt class="docutils literal"><span class="pre">-m</span></tt> switch -- to allow the full Python namespace to be used to
locate modules for execution from the command line.</p>
<p>An earlier version of this PEP included some mistaken assumptions
about the way <tt class="docutils literal">exec</tt> handled locals dictionaries and code from
function objects. These mistaken assumptions led to some unneeded
design complexity which has now been removed - <tt class="docutils literal">run_code</tt> shares all
of the quirks of <tt class="docutils literal">exec</tt>.</p>
<p>Earlier versions of the PEP also exposed a broader API that just the
single <tt class="docutils literal">run_module()</tt> function needed to implement the updates to
the <tt class="docutils literal"><span class="pre">-m</span></tt> switch. In the interests of simplicity, those extra functions
have been dropped from the proposed API.</p>
<p>After the original implementation in SVN, it became clear that holding
the import lock when executing the initial application script was not
correct (e.g. <tt class="docutils literal">python <span class="pre">-m</span> test.regrtest test_threadedimport</tt> failed).
So the <tt class="docutils literal">run_module</tt> function only holds the import lock during the
actual search for the module, and releases it before execution, even if
<tt class="docutils literal">alter_sys</tt> is set.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id20">References</a></h1>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>Special __main__() function in modules
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0299/">http://www.python.org/dev/peps/pep-0299/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td><a class="reference external" href="/dev/peps/pep-0338">PEP 338</a> implementation (runpy module and <tt class="docutils literal"><span class="pre">-m</span></tt> update)
(<a class="reference external" href="http://www.python.org/sf/1429601">http://www.python.org/sf/1429601</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>execmodule Python Cookbook Recipe
(<a class="reference external" href="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/307772">http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/307772</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[4]</a></td><td>New import hooks
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0302/">http://www.python.org/dev/peps/pep-0302/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[5]</a></td><td><a class="reference external" href="/dev/peps/pep-0338">PEP 338</a> documentation (for runpy module)
(<a class="reference external" href="http://www.python.org/sf/1429605">http://www.python.org/sf/1429605</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id21">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
End: -->
</div>



      </div>

      
      <div id="footer">
	<div id="credits">
 	  <a href="/about/website">Website maintained by the Python community</a><br/>
	  <a href="http://www.xs4all.com/" title="Web and email hosting provided by xs4all, Netherlands">hosting by xs4all</a> /
	  <a href="http://www.timparkin.co.uk/" title="Design by Tim Parkin, Yorkshire man, photographer and developer">design by Tim Parkin</a>
	</div>
	Copyright &copy; 1990-2013, <a href='/psf/'>Python Software Foundation</a><br/>
	<a href="/about/legal">Legal Statements</a>
      </div>


    </div>
  </div>
</body>
</html>






