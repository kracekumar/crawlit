<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>PEP 3151 -- Reworking the OS and IO exception hierarchy</title>
  <meta name="keywords" content="PEP 3151 -- Reworking the OS and IO exception hierarchy" />
  <meta name="description" content="PEP 3151 -- Reworking the OS and IO exception hierarchy" />
  <link rel="alternate" type="application/rss+xml" title="Community Events"
        href="http://www.python.org/channews.rdf" />
  <link rel="alternate" type="application/rss+xml" title="Python Recipes"
        href="http://aspn.activestate.com/ASPN/Cookbook/Python/index_rss" />
  <link rel="alternate" type="application/rss+xml" title="Usergroup News"
        href="http://python-groups.blogspot.com/feeds/posts/default" />
  <link rel="alternate" type="application/rss+xml" title="Python Screencasts"
        href="http://www.showmedo.com/latestVideoFeed/rss2.0?tag=python" />
  <link rel="alternate" type="application/rss+xml" title="Python Podcasts"
        href="http://www.awaretek.com/python/index.xml" />
  <link rel="alternate" type="application/rss+xml" title="Foundation News"
        href="http://feeds.feedburner.com/PythonSoftwareFoundationNews" />
  <link rel="alternate" type="application/rss+xml" title="Python Enhancement Proposals"
        href="http://www.python.org/dev/peps/peps.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Job Opportunities"
        href="http://www.python.org/community/jobs/jobs.rss" />
  <link rel="alternate" type="application/rss+xml" title="Reddit Feed of Python What's New Online"
        href="http://www.reddit.com/r/Python/.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Insider"
        href="http://feeds.feedburner.com/PythonInsider" />

  <link rel="stylesheet" type="text/css" media="screen" id="screen-switcher-stylesheet"
        href="/styles/screen-switcher-default.css" />
  <link rel="stylesheet" type="text/css" media="sc&#82;een"
        href="/styles/netscape4.css" />
  <link rel="stylesheet" type="text/css" media="print"
        href="/styles/print.css" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/largestyles.css" title="large text" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/defaultfonts.css" title="default fonts" />

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search under the www.python.org Domain"
        href="/search-pysite.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Wiki"
        href="/search-pywiki.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within Python Books at Google Book Search"
        href="/search-pybooks.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Documentation"
        href="/search-pydocs.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for a Module in the Standard Library"
        href="/search-pymodules.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for Packages inside the Cheeseshop (PyPI)"
        href="/search-pycheese.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search Archives of the Main Python Mailing List"
        href="/search-pythonlist.xml"/>

  <script type="text/javascript" src="/js/iotbs2-key-directors-load.js"></script>
  <script type="text/javascript" src="/js/iotbs2-directors.js"></script>
  <script type="text/javascript" src="/js/iotbs2-core.js"></script>

</head>


<body>
  <!-- Logo -->
  <h1 id="logoheader">
    <a href="/" id="logolink" accesskey="1"><img id="logo" src="/images/python-logo.gif" alt="homepage" border="0" /></a>
  </h1>
  <!-- Skip to Navigation -->
  <div class="skiptonav"><a href="#left-hand-navigation" accesskey="2"><img src="/images/trans.gif" id="skiptonav" alt="skip to navigation" border="0" /></a></div>
  <div class="skiptonav"><a href="#content-body" accesskey="3"><img src="/images/trans.gif" id="skiptocontent" alt="skip to content" border="0" /></a></div>
  <!-- Utility Menu -->
  <div id="utility-menu">
    <!-- Search Box -->
    <div id="searchbox">
      <form method="get" action="http://google.com/search" id="searchform" name="searchform">
        <div id="search">
          <input type="hidden" id="domains" name="domains" value="www.python.org" />
          <input type="hidden" id="sitesearch" name="sitesearch" value="www.python.org" />
          <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
          <input type="text" class="input-text" name="q" id="q" />
          <input type="submit" value="search" class="input-button" name="submit" id="submit" />
          <a href="/search" class="reference">Advanced Search</a>
        </div>
      </form>
    </div>
    <div id="screen-switcher"></div>
  </div>

  <div id="left-hand-navigation">
    <!-- Main Menu -->
    <div id="menu">
      <ul class="level-one">
            <li>
          <a href="/about/" title="About The Python Language">About</a>
        </li>
            <li>
          <a href="/news/" title="Major Happenings Within the Python Community">News</a>
        </li>
            <li>
          <a href="/doc/" title="Tutorials, Library Reference, C API">Documentation</a>
        </li>
            <li>
          <a href="/download/" title="Start Running Python Under Windows, Mac, Linux and Others">Download</a>
        </li>
            <li>
          <a href="/getit/" title="Alternate Download page for China">ä¸è½½</a>
        </li>
            <li>
          <a href="/community/" title="Mailing Lists, Jobs, Conferences, SIGs, Online Chats">Community</a>
        </li>
            <li>
          <a href="/psf/" title="Python Software Foundation">Foundation</a>
        </li>
            <li>
          <a href="http://docs.python.org/devguide/" title="Development of the Python language and website">Core Development</a>
        </li>
      </ul>
    </div>

    <!-- Quick Links -->
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/">Python Wiki</a></h4>
    <h4><a style="margin-top:1.5em" href="http://blog.python.org/">Python Insider Blog</a></h4>
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/Python2orPython3">Python 2 or 3?</a></h4>
    <h4><a style="color:#D58228; margin-top:1.5em" href="/psf/donations/">Help Fund Python</a></h4>
    <div style="align:center; padding-top: 0.5em; padding-left: 1em">
      <a href="/psf/donations/"><img width="116" height="42" src="/images/donate.png" alt="" title="" /></a>
    </div>
    <div style="align:center; padding-top: 0.5em; padding-left: 2.5em">
            <a href="http://wiki.python.org/moin/Languages"><img
	      style="align:center"
              width="94" height="46"
	      src="/images/worldmap.jpg" alt="[Python resources in languages other than English]" /></a>
    </div>
    <div style="align:center; padding-top: 0.0em; padding-left: 0em">
       <h4><a href="http://wiki.python.org/moin/Languages">Non-English Resources</a></h4>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Release%20Schedule&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com/public/basic.ics">
                Python Release Schedule iCal Calendar
            </a>
        </iframe>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Events%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com/public/basic.ics">
                Python Events iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=User%20Group%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com&amp;color=%23125A12&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com/public/basic.ics">
                Python User Group iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
  </div>

  <div id="content-body">
    <div id="body-main">
      <div id="content">
        
          <div id="breadcrumb">
               <a href="/dev/peps/">PEP Index</a>
               <span class="breadcrumb-separator">&gt;</span>
            
            PEP 3151 -- Reworking the OS and IO exception hierarchy
          </div>



        <!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">3151</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Reworking the OS and IO exception hierarchy</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">7de560665b2c</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="http://hg.python.org/peps/file/tip/pep-3151.txt">2012-05-06 16:35:13 +1000 (Sun, 06 May 2012)</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Antoine Pitrou &lt;solipsis&#32;&#97;t&#32;pitrou.net&gt;</td>
</tr>
<tr class="field"><th class="field-name">BDFL-Delegate:</th><td class="field-body">Barry Warsaw</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">2010-07-21</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.3</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="http://mail.python.org/pipermail/python-dev/2011-October/114033.html">http://mail.python.org/pipermail/python-dev/2011-October/114033.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id11">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id12">Rationale</a><ul>
<li><a class="reference internal" href="#confusing-set-of-os-related-exceptions" id="id13">Confusing set of OS-related exceptions</a></li>
<li><a class="reference internal" href="#lack-of-fine-grained-exceptions" id="id14">Lack of fine-grained exceptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compatibility-strategy" id="id15">Compatibility strategy</a></li>
<li><a class="reference internal" href="#step-1-coalesce-exception-types" id="id16">Step 1: coalesce exception types</a><ul>
<li><a class="reference internal" href="#justification" id="id17">Justification</a></li>
<li><a class="reference internal" href="#exception-attributes" id="id18">Exception attributes</a></li>
<li><a class="reference internal" href="#deprecation-of-names" id="id19">Deprecation of names</a><ul>
<li><a class="reference internal" href="#built-in-exceptions" id="id20">built-in exceptions</a></li>
<li><a class="reference internal" href="#module-level-exceptions" id="id21">module-level exceptions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#step-2-define-additional-subclasses" id="id22">Step 2: define additional subclasses</a><ul>
<li><a class="reference internal" href="#prerequisite" id="id23">Prerequisite</a></li>
<li><a class="reference internal" href="#new-exception-classes" id="id24">New exception classes</a></li>
<li><a class="reference internal" href="#naming" id="id25">Naming</a></li>
<li><a class="reference internal" href="#id2" id="id26">Exception attributes</a></li>
<li><a class="reference internal" href="#implementation" id="id27">Implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#possible-objections" id="id28">Possible objections</a><ul>
<li><a class="reference internal" href="#namespace-pollution" id="id29">Namespace pollution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#earlier-discussion" id="id30">Earlier discussion</a></li>
<li><a class="reference internal" href="#id5" id="id31">Implementation</a></li>
<li><a class="reference internal" href="#possible-alternative" id="id32">Possible alternative</a><ul>
<li><a class="reference internal" href="#pattern-matching" id="id33">Pattern matching</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exceptions-ignored-by-this-pep" id="id34">Exceptions ignored by this PEP</a></li>
<li><a class="reference internal" href="#appendix-a-survey-of-common-errnos" id="id35">Appendix A: Survey of common errnos</a><ul>
<li><a class="reference internal" href="#common-errnos-with-oserror" id="id36">Common errnos with OSError</a></li>
<li><a class="reference internal" href="#common-errnos-with-ioerror" id="id37">Common errnos with IOError</a></li>
<li><a class="reference internal" href="#common-errnos-with-socket-error" id="id38">Common errnos with socket.error</a></li>
<li><a class="reference internal" href="#common-errnos-with-select-error" id="id39">Common errnos with select.error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-b-survey-of-raised-os-and-io-errors" id="id40">Appendix B: Survey of raised OS and IO errors</a><ul>
<li><a class="reference internal" href="#about-vmserror" id="id41">About VMSError</a></li>
<li><a class="reference internal" href="#interpreter-core" id="id42">Interpreter core</a></li>
<li><a class="reference internal" href="#standard-library" id="id43">Standard library</a><ul>
<li><a class="reference internal" href="#bz2" id="id44">bz2</a></li>
<li><a class="reference internal" href="#curses" id="id45">curses</a></li>
<li><a class="reference internal" href="#dbm-gnu-dbm-ndbm" id="id46">dbm.gnu, dbm.ndbm</a></li>
<li><a class="reference internal" href="#fcntl" id="id47">fcntl</a></li>
<li><a class="reference internal" href="#imp-module" id="id48">imp module</a></li>
<li><a class="reference internal" href="#io-module" id="id49">io module</a></li>
<li><a class="reference internal" href="#mmap" id="id50">mmap</a></li>
<li><a class="reference internal" href="#multiprocessing" id="id51">multiprocessing</a></li>
<li><a class="reference internal" href="#os-posix" id="id52">os / posix</a></li>
<li><a class="reference internal" href="#ossaudiodev" id="id53">ossaudiodev</a></li>
<li><a class="reference internal" href="#readline" id="id54">readline</a></li>
<li><a class="reference internal" href="#select" id="id55">select</a></li>
<li><a class="reference internal" href="#signal" id="id56">signal</a></li>
<li><a class="reference internal" href="#socket" id="id57">socket</a></li>
<li><a class="reference internal" href="#sys" id="id58">sys</a></li>
<li><a class="reference internal" href="#time" id="id59">time</a></li>
<li><a class="reference internal" href="#zipimport" id="id60">zipimport</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgments" id="id61">Acknowledgments</a></li>
<li><a class="reference internal" href="#references" id="id62">References</a></li>
<li><a class="reference internal" href="#copyright" id="id63">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id11">Abstract</a></h1>
<p>The standard exception hierarchy is an important part of the Python
language.  It has two defining qualities: it is both generic and
selective.  Generic in that the same exception type can be raised
- and handled - regardless of the context (for example, whether you are
trying to add something to an integer, to call a string method, or to write
an object on a socket, a TypeError will be raised for bad argument types).
Selective in that it allows the user to easily handle (silence, examine,
process, store or encapsulate...) specific kinds of error conditions
while letting other errors bubble up to higher calling contexts.  For
example, you can choose to catch ZeroDivisionErrors without affecting
the default handling of other ArithmeticErrors (such as OverflowErrors).</p>
<p>This PEP proposes changes to a part of the exception hierarchy in
order to better embody the qualities mentioned above: the errors
related to operating system calls (OSError, IOError, mmap.error,
select.error, and all their subclasses).</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id12">Rationale</a></h1>
<div class="section" id="confusing-set-of-os-related-exceptions">
<h2><a class="toc-backref" href="#id13">Confusing set of OS-related exceptions</a></h2>
<p>OS-related (or system call-related) exceptions are currently a diversity
of classes, arranged in the following sub-hierarchies:</p>
<pre class="literal-block">
+-- EnvironmentError
    +-- IOError
        +-- io.BlockingIOError
        +-- io.UnsupportedOperation (also inherits from ValueError)
        +-- socket.error
            +-- socket.gaierror
            +-- socket.herror
            +-- socket.timeout
    +-- OSError
        +-- VMSError
        +-- WindowsError
    +-- mmap.error
+-- select.error
</pre>
<p>While some of these distinctions can be explained by implementation
considerations, they are often not very logical at a higher level.  The
line separating OSError and IOError, for example, is often blurry.  Consider
the following:</p>
<pre class="literal-block">
&gt;&gt;&gt; os.remove(&quot;fff&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
OSError: [Errno 2] No such file or directory: 'fff'
&gt;&gt;&gt; open(&quot;fff&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 2] No such file or directory: 'fff'
</pre>
<p>The same error condition (a non-existing file) gets cast as two different
exceptions depending on which library function was called.  The reason
for this is that the <tt class="docutils literal">os</tt> module exclusively raises OSError (or its
subclass WindowsError) while the <tt class="docutils literal">io</tt> module mostly raises IOError.
However, the user is interested in the nature of the error, not in which
part of the interpreter it comes from (since the latter is obvious from
reading the traceback message or application source code).</p>
<p>In fact, it is hard to think of any situation where OSError should be
caught but not IOError, or the reverse.</p>
<p>A further proof of the ambiguity of this segmentation is that the standard
library itself sometimes has problems deciding.  For example, in the
<tt class="docutils literal">select</tt> module, similar failures will raise <tt class="docutils literal">select.error</tt>, <tt class="docutils literal">OSError</tt>
or <tt class="docutils literal">IOError</tt> depending on whether you are using select(), a poll object,
a kqueue object, or an epoll object.  This makes user code uselessly
complicated since it has to be prepared to catch various exception types,
depending on which exact implementation of a single primitive it chooses
to use at runtime.</p>
<p>As for WindowsError, it seems to be a pointless distinction.  First, it
only exists on Windows systems, which requires tedious compatibility code
in cross-platform applications (such code can be found in <tt class="docutils literal">Lib/shutil.py</tt>).
Second, it inherits from OSError and is raised for similar errors as OSError
is raised for on other systems. Third, the user wanting access to low-level
exception specifics has to examine the <tt class="docutils literal">errno</tt> or <tt class="docutils literal">winerror</tt> attribute
anyway.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#appendix-b">Appendix B</a> surveys the use of the various exception types across
the interpreter and the standard library.</p>
</div>
</div>
<div class="section" id="lack-of-fine-grained-exceptions">
<h2><a class="toc-backref" href="#id14">Lack of fine-grained exceptions</a></h2>
<p>The current variety of OS-related exceptions doesn't allow the user to filter
easily for the desired kinds of failures.  As an example, consider the task
of deleting a file if it exists.  The Look Before You Leap (LBYL) idiom
suffers from an obvious race condition:</p>
<pre class="literal-block">
if os.path.exists(filename):
    os.remove(filename)
</pre>
<p>If a file named as <tt class="docutils literal">filename</tt> is created by another thread or process
between the calls to <tt class="docutils literal">os.path.exists</tt> and <tt class="docutils literal">os.remove</tt>, it won't be
deleted.  This can produce bugs in the application, or even security issues.</p>
<p>Therefore, the solution is to try to remove the file, and ignore the error
if the file doesn't exist (an idiom known as Easier to Ask Forgiveness
than to get Permission, or EAFP).  Careful code will read like the following
(which works under both POSIX and Windows systems):</p>
<pre class="literal-block">
try:
    os.remove(filename)
except OSError as e:
    if e.errno != errno.ENOENT:
        raise
</pre>
<p>or even:</p>
<pre class="literal-block">
try:
    os.remove(filename)
except EnvironmentError as e:
    if e.errno != errno.ENOENT:
        raise
</pre>
<p>This is a lot more to type, and also forces the user to remember the various
cryptic mnemonics from the <tt class="docutils literal">errno</tt> module.  It imposes an additional
cognitive burden and gets tiresome rather quickly.  Consequently, many
programmers will instead write the following code, which silences exceptions
too broadly:</p>
<pre class="literal-block">
try:
    os.remove(filename)
except OSError:
    pass
</pre>
<p><tt class="docutils literal">os.remove</tt> can raise an OSError not only when the file doesn't exist,
but in other possible situations (for example, the filename points to a
directory, or the current process doesn't have permission to remove
the file), which all indicate bugs in the application logic and therefore
shouldn't be silenced.  What the programmer would like to write instead is
something such as:</p>
<pre class="literal-block">
try:
    os.remove(filename)
except FileNotFoundError:
    pass
</pre>
</div>
</div>
<div class="section" id="compatibility-strategy">
<h1><a class="toc-backref" href="#id15">Compatibility strategy</a></h1>
<p>Reworking the exception hierarchy will obviously change the exact semantics
of at least some existing code.  While it is not possible to improve on the
current situation without changing exact semantics, it is possible to define
a narrower type of compatibility, which we will call <em>useful compatibility</em>.</p>
<p>For this we first must explain what we will call <em>careful</em> and <em>careless</em>
exception handling.  <em>Careless</em> (or &quot;naÃ¯ve&quot;) code is defined as code which
blindly catches any of <tt class="docutils literal">OSError</tt>, <tt class="docutils literal">IOError</tt>, <tt class="docutils literal">socket.error</tt>,
<tt class="docutils literal">mmap.error</tt>, <tt class="docutils literal">WindowsError</tt>, <tt class="docutils literal">select.error</tt> without checking the <tt class="docutils literal">errno</tt>
attribute.  This is because such exception types are much too broad to signify
anything.  Any of them can be raised for error conditions as diverse as: a
bad file descriptor (which will usually indicate a programming error), an
unconnected socket (ditto), a socket timeout, a file type mismatch, an invalid
argument, a transmission failure, insufficient permissions, a non-existent
directory, a full filesystem, etc.</p>
<p>(moreover, the use of certain of these exceptions is irregular; <a class="reference internal" href="#appendix-b">Appendix B</a>
exposes the case of the <a class="reference internal" href="#select">select</a> module, which raises different exceptions
depending on the implementation)</p>
<p><em>Careful</em> code is defined as code which, when catching any of the above
exceptions, examines the <tt class="docutils literal">errno</tt> attribute to determine the actual error
condition and takes action depending on it.</p>
<p>Then we can define <em>useful compatibility</em> as follows:</p>
<ul>
<li><p class="first">useful compatibility doesn't make exception catching any narrower, but
it can be broader for <em>careless</em> exception-catching code.  Given the following
kind of snippet, all exceptions caught before this PEP will also be
caught after this PEP, but the reverse may be false (because the coalescing
of <tt class="docutils literal">OSError</tt>, <tt class="docutils literal">IOError</tt> and others means the <tt class="docutils literal">except</tt> clause throws
a slightly broader net):</p>
<pre class="literal-block">
try:
    ...
    os.remove(filename)
    ...
except OSError:
    pass
</pre>
</li>
<li><p class="first">useful compatibility doesn't alter the behaviour of <em>careful</em>
exception-catching code.  Given the following kind of snippet, the same
errors should be silenced or re-raised, regardless of whether this PEP
has been implemented or not:</p>
<pre class="literal-block">
try:
    os.remove(filename)
except OSError as e:
    if e.errno != errno.ENOENT:
        raise
</pre>
</li>
</ul>
<p>The rationale for this compromise is that careless code can't really be
helped, but at least code which &quot;works&quot; won't suddenly raise errors and
crash.  This is important since such code is likely to be present in
scripts used as cron tasks or automated system administration programs.</p>
<p>Careful code, on the other hand, should not be penalized.  Actually, one
purpose of this PEP is to ease writing careful code.</p>
</div>
<div class="section" id="step-1-coalesce-exception-types">
<span id="step-1"></span><h1><a class="toc-backref" href="#id16">Step 1: coalesce exception types</a></h1>
<p>The first step of the resolution is to coalesce existing exception types.
The following changes are proposed:</p>
<ul class="simple">
<li>alias both socket.error and select.error to OSError</li>
<li>alias mmap.error to OSError</li>
<li>alias both WindowsError and VMSError to OSError</li>
<li>alias IOError to OSError</li>
<li>coalesce EnvironmentError into OSError</li>
</ul>
<p>Each of these changes doesn't preserve exact compatibility, but it does
preserve <em>useful compatibility</em> (see &quot;compatibility&quot; section above).</p>
<p>Each of these changes can be accepted or refused individually, but of course
it is considered that the greatest impact can be achieved if this first step
is accepted in full.  In this case, the IO exception sub-hierarchy would
become:</p>
<pre class="literal-block">
+-- OSError   (replacing IOError, WindowsError, EnvironmentError, etc.)
    +-- io.BlockingIOError
    +-- io.UnsupportedOperation (also inherits from ValueError)
    +-- socket.gaierror
    +-- socket.herror
    +-- socket.timeout
</pre>
<div class="section" id="justification">
<h2><a class="toc-backref" href="#id17">Justification</a></h2>
<p>Not only does this first step present the user a simpler landscape as
explained in the <a class="reference internal" href="#rationale">rationale</a> section, but it also allows for a better
and more complete resolution of <a class="reference internal" href="#step-2">Step 2</a> (see <a class="reference internal" href="#prerequisite">Prerequisite</a>).</p>
<p>The rationale for keeping <tt class="docutils literal">OSError</tt> as the official name for generic
OS-related exceptions is that it, precisely, is more generic than <tt class="docutils literal">IOError</tt>.
<tt class="docutils literal">EnvironmentError</tt> is more tedious to type and also much lesser-known.</p>
<p>The survey in <a class="reference internal" href="#appendix-b">Appendix B</a> shows that IOError is the dominant
error today in the standard library.  As for third-party Python code,
Google Code Search shows IOError being ten times more popular than
EnvironmentError in user code, and three times more popular than OSError
<a class="footnote-reference" href="#id9" id="id1">[3]</a>.  However, with no intention to deprecate IOError in the middle
term, the lesser popularity of OSError is not a problem.</p>
</div>
<div class="section" id="exception-attributes">
<h2><a class="toc-backref" href="#id18">Exception attributes</a></h2>
<p>Since WindowsError is coalesced into OSError, the latter gains a <tt class="docutils literal">winerror</tt>
attribute under Windows.  It is set to None under situations where it is not
meaningful, as is already the case with the <tt class="docutils literal">errno</tt>, <tt class="docutils literal">filename</tt> and
<tt class="docutils literal">strerror</tt> attributes (for example when OSError is raised directly by
Python code).</p>
</div>
<div class="section" id="deprecation-of-names">
<h2><a class="toc-backref" href="#id19">Deprecation of names</a></h2>
<p>The following paragraphs outline a possible deprecation strategy for
old exception names.  However, it has been decided to keep them as aliases
for the time being.  This decision could be revised in time for Python 4.0.</p>
<div class="section" id="built-in-exceptions">
<h3><a class="toc-backref" href="#id20">built-in exceptions</a></h3>
<p>Deprecating the old built-in exceptions cannot be done in a straightforward
fashion by intercepting all lookups in the builtins namespace, since these
are performance-critical.  We also cannot work at the object level, since
the deprecated names will be aliased to non-deprecated objects.</p>
<p>A solution is to recognize these names at compilation time, and
then emit a separate <tt class="docutils literal">LOAD_OLD_GLOBAL</tt> opcode instead of the regular
<tt class="docutils literal">LOAD_GLOBAL</tt>.  This specialized opcode will handle the output of a
DeprecationWarning (or PendingDeprecationWarning, depending on the policy
decided upon) when the name doesn't exist in the globals namespace, but
only in the builtins one.  This will be enough to avoid false positives
(for example if someone defines their own <tt class="docutils literal">OSError</tt> in a module), and
false negatives will be rare (for example when someone accesses <tt class="docutils literal">OSError</tt>
through the <tt class="docutils literal">builtins</tt> module rather than directly).</p>
</div>
<div class="section" id="module-level-exceptions">
<h3><a class="toc-backref" href="#id21">module-level exceptions</a></h3>
<p>The above approach cannot be used easily, since it would require
special-casing some modules when compiling code objects.  However, these
names are by construction much less visible (they don't appear in the
builtins namespace), and lesser-known too, so we might decide to let them
live in their own namespaces.</p>
</div>
</div>
</div>
<div class="section" id="step-2-define-additional-subclasses">
<span id="step-2"></span><h1><a class="toc-backref" href="#id22">Step 2: define additional subclasses</a></h1>
<p>The second step of the resolution is to extend the hierarchy by defining
subclasses which will be raised, rather than their parent, for specific
errno values.  Which errno values is subject to discussion, but a survey
of existing exception matching practices (see <a class="reference internal" href="#appendix-a">Appendix A</a>) helps us
propose a reasonable subset of all values.  Trying to map all errno
mnemonics, indeed, seems foolish, pointless, and would pollute the root
namespace.</p>
<p>Furthermore, in a couple of cases, different errno values could raise
the same exception subclass.  For example, EAGAIN, EALREADY, EWOULDBLOCK
and EINPROGRESS are all used to signal that an operation on a non-blocking
socket would block (and therefore needs trying again later).  They could
therefore all raise an identical subclass and let the user examine the
<tt class="docutils literal">errno</tt> attribute if (s)he so desires (see below &quot;exception
attributes&quot;).</p>
<div class="section" id="prerequisite">
<h2><a class="toc-backref" href="#id23">Prerequisite</a></h2>
<p><a class="reference internal" href="#step-1">Step 1</a> is a loose prerequisite for this.</p>
<p>Prerequisite, because some errnos can currently be attached to different
exception classes: for example, ENOENT can be attached to both OSError and
IOError, depending on the context.  If we don't want to break <em>useful
compatibility</em>, we can't make an <tt class="docutils literal">except OSError</tt> (or IOError) fail to
match an exception where it would succeed today.</p>
<p>Loose, because we could decide for a partial resolution of step 2
if existing exception classes are not coalesced: for example, ENOENT could
raise a hypothetical FileNotFoundError where an IOError was previously
raised, but continue to raise OSError otherwise.</p>
<p>The dependency on step 1 could be totally removed if the new subclasses
used multiple inheritance to match with all of the existing superclasses
(or, at least, OSError and IOError, which are arguable the most prevalent
ones).  It would, however, make the hierarchy more complicated and
therefore harder to grasp for the user.</p>
</div>
<div class="section" id="new-exception-classes">
<h2><a class="toc-backref" href="#id24">New exception classes</a></h2>
<p>The following tentative list of subclasses, along with a description and
the list of errnos mapped to them, is submitted to discussion:</p>
<ul class="simple">
<li><tt class="docutils literal">FileExistsError</tt>: trying to create a file or directory which already
exists (EEXIST)</li>
<li><tt class="docutils literal">FileNotFoundError</tt>: for all circumstances where a file and directory is
requested but doesn't exist (ENOENT)</li>
<li><tt class="docutils literal">IsADirectoryError</tt>: file-level operation (open(), os.remove()...)
requested on a directory (EISDIR)</li>
<li><tt class="docutils literal">NotADirectoryError</tt>: directory-level operation requested on something
else (ENOTDIR)</li>
<li><tt class="docutils literal">PermissionError</tt>: trying to run an operation without the adequate access
rights - for example filesystem permissions (EACCES, EPERM)</li>
<li><tt class="docutils literal">BlockingIOError</tt>: an operation would block on an object (e.g. socket) set
for non-blocking operation (EAGAIN, EALREADY, EWOULDBLOCK, EINPROGRESS);
this is the existing <tt class="docutils literal">io.BlockingIOError</tt> with an extended role</li>
<li><tt class="docutils literal">BrokenPipeError</tt>: trying to write on a pipe while the other end has been
closed, or trying to write on a socket which has been shutdown for writing
(EPIPE, ESHUTDOWN)</li>
<li><tt class="docutils literal">InterruptedError</tt>: a system call was interrupted by an incoming signal
(EINTR)</li>
<li><tt class="docutils literal">ConnectionAbortedError</tt>: connection attempt aborted by peer (ECONNABORTED)</li>
<li><tt class="docutils literal">ConnectionRefusedError</tt>: connection reset by peer (ECONNREFUSED)</li>
<li><tt class="docutils literal">ConnectionResetError</tt>: connection reset by peer (ECONNRESET)</li>
<li><tt class="docutils literal">TimeoutError</tt>: connection timed out (ETIMEDOUT); this can be re-cast
as a generic timeout exception, replacing <tt class="docutils literal">socket.timeout</tt> and also useful
for other types of timeout (for example in Lock.acquire())</li>
<li><tt class="docutils literal">ChildProcessError</tt>: operation on a child process failed (ECHILD);
this is raised mainly by the wait() family of functions.</li>
<li><tt class="docutils literal">ProcessLookupError</tt>: the given process (as identified by, e.g., its
process id) doesn't exist (ESRCH).</li>
</ul>
<p>In addition, the following exception class is proposed for inclusion:</p>
<ul class="simple">
<li><tt class="docutils literal">ConnectionError</tt>: a base class for <tt class="docutils literal">ConnectionAbortedError</tt>,
<tt class="docutils literal">ConnectionRefusedError</tt> and <tt class="docutils literal">ConnectionResetError</tt></li>
</ul>
<p>The following drawing tries to sum up the proposed additions, along with
the corresponding errno values (where applicable).  The root of the
sub-hierarchy (OSError, assuming <a class="reference internal" href="#step-1">Step 1</a> is accepted in full) is not
shown:</p>
<pre class="literal-block">
+-- BlockingIOError        EAGAIN, EALREADY, EWOULDBLOCK, EINPROGRESS
+-- ChildProcessError                                          ECHILD
+-- ConnectionError
    +-- BrokenPipeError                              EPIPE, ESHUTDOWN
    +-- ConnectionAbortedError                           ECONNABORTED
    +-- ConnectionRefusedError                           ECONNREFUSED
    +-- ConnectionResetError                               ECONNRESET
+-- FileExistsError                                            EEXIST
+-- FileNotFoundError                                          ENOENT
+-- InterruptedError                                            EINTR
+-- IsADirectoryError                                          EISDIR
+-- NotADirectoryError                                        ENOTDIR
+-- PermissionError                                     EACCES, EPERM
+-- ProcessLookupError                                          ESRCH
+-- TimeoutError                                            ETIMEDOUT
</pre>
</div>
<div class="section" id="naming">
<h2><a class="toc-backref" href="#id25">Naming</a></h2>
<p>Various naming controversies can arise.  One of them is whether all
exception class names should end in &quot;<tt class="docutils literal">Error</tt>&quot;.  In favour is consistency
with the rest of the exception hiearchy, against is concision (especially
with long names such as <tt class="docutils literal">ConnectionAbortedError</tt>).</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id26">Exception attributes</a></h2>
<p>In order to preserve <em>useful compatibility</em>, these subclasses should still
set adequate values for the various exception attributes defined on the
superclass (for example <tt class="docutils literal">errno</tt>, <tt class="docutils literal">filename</tt>, and optionally
<tt class="docutils literal">winerror</tt>).</p>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id27">Implementation</a></h2>
<p>Since it is proposed that the subclasses are raised based purely on the
value of <tt class="docutils literal">errno</tt>, little or no changes should be required in extension
modules (either standard or third-party).</p>
<p>The first possibility is to adapt the <tt class="docutils literal">PyErr_SetFromErrno()</tt> family
of functions (<tt class="docutils literal">PyErr_SetFromWindowsErr()</tt> under Windows) to raise the
appropriate OSError subclass.  This wouldn't cover, however, Python
code raising OSError directly, using the following idiom (seen in
<tt class="docutils literal">Lib/tempfile.py</tt>):</p>
<pre class="literal-block">
raise IOError(_errno.EEXIST, &quot;No usable temporary file name found&quot;)
</pre>
<p>A second possibility, suggested by Marc-Andre Lemburg, is to adapt
<tt class="docutils literal">OSError.__new__</tt> to instantiate the appropriate subclass.  This has
the benefit of also covering Python code such as the above.</p>
</div>
</div>
<div class="section" id="possible-objections">
<h1><a class="toc-backref" href="#id28">Possible objections</a></h1>
<div class="section" id="namespace-pollution">
<h2><a class="toc-backref" href="#id29">Namespace pollution</a></h2>
<p>Making the exception hierarchy finer-grained makes the root (or builtins)
namespace larger.  This is to be moderated, however, as:</p>
<ul class="simple">
<li>only a handful of additional classes are proposed;</li>
<li>while standard exception types live in the root namespace, they are
visually distinguished by the fact that they use the CamelCase convention,
while almost all other builtins use lowercase naming (except True, False,
None, Ellipsis and NotImplemented)</li>
</ul>
<p>An alternative would be to provide a separate module containing the
finer-grained exceptions, but that would defeat the purpose of
encouraging careful code over careless code, since the user would first
have to import the new module instead of using names already accessible.</p>
</div>
</div>
<div class="section" id="earlier-discussion">
<h1><a class="toc-backref" href="#id30">Earlier discussion</a></h1>
<p>While this is the first time such as formal proposal is made, the idea
has received informal support in the past <a class="footnote-reference" href="#id7" id="id3">[1]</a>; both the introduction
of finer-grained exception classes and the coalescing of OSError and
IOError.</p>
<p>The removal of WindowsError alone has been discussed and rejected
as part of another PEP <a class="footnote-reference" href="#id8" id="id4">[2]</a>, but there seemed to be a consensus that the
distinction with OSError wasn't meaningful.  This supports at least its
aliasing with OSError.</p>
</div>
<div class="section" id="id5">
<h1><a class="toc-backref" href="#id31">Implementation</a></h1>
<p>The reference implementation has been integrated into Python 3.3.
It was formerly developed in <a class="reference external" href="http://hg.python.org/features/pep-3151/">http://hg.python.org/features/pep-3151/</a> in
branch <tt class="docutils literal"><span class="pre">pep-3151</span></tt>, and also tracked on the bug tracker at
<a class="reference external" href="http://bugs.python.org/issue12555">http://bugs.python.org/issue12555</a>.
It has been successfully tested on a variety of systems: Linux, Windows,
OpenIndiana and FreeBSD buildbots.</p>
<p>One source of trouble has been with the respective constructors of <tt class="docutils literal">OSError</tt>
and <tt class="docutils literal">WindowsError</tt>, which were incompatible.  The way it is solved is by
keeping the <tt class="docutils literal">OSError</tt> signature and adding a fourth optional argument
to allow passing the Windows error code (which is different from the POSIX
errno).  The fourth argument is stored as <tt class="docutils literal">winerror</tt> and its POSIX
translation as <tt class="docutils literal">errno</tt>.  The <tt class="docutils literal">PyErr_SetFromWindowsErr*</tt> functions have
been adapted to use the right constructor call.</p>
<p>A slight complication is when the <tt class="docutils literal">PyErr_SetExcFromWindowsErr*</tt> functions
are called with <tt class="docutils literal">OSError</tt> rather than <tt class="docutils literal">WindowsError</tt>: the <tt class="docutils literal">errno</tt>
attribute of the exception object would store the Windows error code (such
as 109 for ERROR_BROKEN_PIPE) rather than its POSIX translation (such as 32
for EPIPE), which it does now.  For non-socket error codes, this only occurs
in the private <tt class="docutils literal">_multiprocessing</tt> module for which there is no compatibility
concern.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p>For socket errors, the &quot;POSIX errno&quot; as reflected by the <tt class="docutils literal">errno</tt> module
is numerically equal to the <a class="reference external" href="http://msdn.microsoft.com/en-us/library/ms740668%28v=vs.85%29.aspx">Windows Socket error code</a>
returned by the <tt class="docutils literal">WSAGetLastError</tt> system call:</p>
<pre class="last literal-block">
&gt;&gt;&gt; errno.EWOULDBLOCK
10035
&gt;&gt;&gt; errno.WSAEWOULDBLOCK
10035
</pre>
</div>
</div>
<div class="section" id="possible-alternative">
<h1><a class="toc-backref" href="#id32">Possible alternative</a></h1>
<div class="section" id="pattern-matching">
<h2><a class="toc-backref" href="#id33">Pattern matching</a></h2>
<p>Another possibility would be to introduce an advanced pattern matching
syntax when catching exceptions.  For example:</p>
<pre class="literal-block">
try:
    os.remove(filename)
except OSError as e if e.errno == errno.ENOENT:
    pass
</pre>
<p>Several problems with this proposal:</p>
<ul class="simple">
<li>it introduces new syntax, which is perceived by the author to be a heavier
change compared to reworking the exception hierarchy</li>
<li>it doesn't decrease typing effort significantly</li>
<li>it doesn't relieve the programmer from the burden of having to remember
errno mnemonics</li>
</ul>
</div>
</div>
<div class="section" id="exceptions-ignored-by-this-pep">
<h1><a class="toc-backref" href="#id34">Exceptions ignored by this PEP</a></h1>
<p>This PEP ignores <tt class="docutils literal">EOFError</tt>, which signals a truncated input stream in
various protocol and file format implementations (for example <tt class="docutils literal">GzipFile</tt>).
<tt class="docutils literal">EOFError</tt> is not OS- or IO-related, it is a logical error raised at
a higher level.</p>
<p>This PEP also ignores <tt class="docutils literal">SSLError</tt>, which is raised by the <tt class="docutils literal">ssl</tt> module
in order to propagate errors signalled by the <tt class="docutils literal">OpenSSL</tt> library.  Ideally,
<tt class="docutils literal">SSLError</tt> would benefit from a similar but separate treatment since it
defines its own constants for error types (<tt class="docutils literal">ssl.SSL_ERROR_WANT_READ</tt>,
etc.).  In Python 3.2, <tt class="docutils literal">SSLError</tt> is already replaced with <tt class="docutils literal">socket.timeout</tt>
when it signals a socket timeout (see <a class="reference external" href="http://bugs.python.org/issue10272">issue 10272</a>).</p>
<p>Endly, the fate of <tt class="docutils literal">socket.gaierror</tt> and <tt class="docutils literal">socket.herror</tt> is not settled.
While they would deserve less cryptic names, this can be handled separately
from the exception hierarchy reorganization effort.</p>
</div>
<div class="section" id="appendix-a-survey-of-common-errnos">
<span id="appendix-a"></span><h1><a class="toc-backref" href="#id35">Appendix A: Survey of common errnos</a></h1>
<p>This is a quick inventory of the various errno mnemonics checked for in
the standard library and its tests, as part of <tt class="docutils literal">except</tt> clauses.</p>
<div class="section" id="common-errnos-with-oserror">
<h2><a class="toc-backref" href="#id36">Common errnos with OSError</a></h2>
<ul class="simple">
<li><tt class="docutils literal">EBADF</tt>: bad file descriptor (usually means the file descriptor was
closed)</li>
<li><tt class="docutils literal">EEXIST</tt>: file or directory exists</li>
<li><tt class="docutils literal">EINTR</tt>: interrupted function call</li>
<li><tt class="docutils literal">EISDIR</tt>: is a directory</li>
<li><tt class="docutils literal">ENOTDIR</tt>: not a directory</li>
<li><tt class="docutils literal">ENOENT</tt>: no such file or directory</li>
<li><tt class="docutils literal">EOPNOTSUPP</tt>: operation not supported on socket
(possible confusion with the existing io.UnsupportedOperation)</li>
<li><tt class="docutils literal">EPERM</tt>: operation not permitted (when using e.g. os.setuid())</li>
</ul>
</div>
<div class="section" id="common-errnos-with-ioerror">
<h2><a class="toc-backref" href="#id37">Common errnos with IOError</a></h2>
<ul class="simple">
<li><tt class="docutils literal">EACCES</tt>: permission denied (for filesystem operations)</li>
<li><tt class="docutils literal">EBADF</tt>: bad file descriptor (with select.epoll); read operation on a
write-only GzipFile, or vice-versa</li>
<li><tt class="docutils literal">EBUSY</tt>: device or resource busy</li>
<li><tt class="docutils literal">EISDIR</tt>: is a directory (when trying to open())</li>
<li><tt class="docutils literal">ENODEV</tt>: no such device</li>
<li><tt class="docutils literal">ENOENT</tt>: no such file or directory (when trying to open())</li>
<li><tt class="docutils literal">ETIMEDOUT</tt>: connection timed out</li>
</ul>
</div>
<div class="section" id="common-errnos-with-socket-error">
<h2><a class="toc-backref" href="#id38">Common errnos with socket.error</a></h2>
<p>All these errors may also be associated with a plain IOError, for example
when calling read() on a socket's file descriptor.</p>
<ul class="simple">
<li><tt class="docutils literal">EAGAIN</tt>: resource temporarily unavailable (during a non-blocking socket
call except connect())</li>
<li><tt class="docutils literal">EALREADY</tt>: connection already in progress (during a non-blocking
connect())</li>
<li><tt class="docutils literal">EINPROGRESS</tt>: operation in progress (during a non-blocking connect())</li>
<li><tt class="docutils literal">EINTR</tt>: interrupted function call</li>
<li><tt class="docutils literal">EISCONN</tt>: the socket is connected</li>
<li><tt class="docutils literal">ECONNABORTED</tt>: connection aborted by peer (during an accept() call)</li>
<li><tt class="docutils literal">ECONNREFUSED</tt>: connection refused by peer</li>
<li><tt class="docutils literal">ECONNRESET</tt>: connection reset by peer</li>
<li><tt class="docutils literal">ENOTCONN</tt>: socket not connected</li>
<li><tt class="docutils literal">ESHUTDOWN</tt>: cannot send after transport endpoint shutdown</li>
<li><tt class="docutils literal">EWOULDBLOCK</tt>: same reasons as <tt class="docutils literal">EAGAIN</tt></li>
</ul>
</div>
<div class="section" id="common-errnos-with-select-error">
<h2><a class="toc-backref" href="#id39">Common errnos with select.error</a></h2>
<ul class="simple">
<li><tt class="docutils literal">EINTR</tt>: interrupted function call</li>
</ul>
</div>
</div>
<div class="section" id="appendix-b-survey-of-raised-os-and-io-errors">
<span id="appendix-b"></span><h1><a class="toc-backref" href="#id40">Appendix B: Survey of raised OS and IO errors</a></h1>
<div class="section" id="about-vmserror">
<h2><a class="toc-backref" href="#id41">About VMSError</a></h2>
<p>VMSError is completely unused by the interpreter core and the standard
library.  It was added as part of the OpenVMS patches submitted in 2002
by Jean-FranÃ§ois PiÃ©ronne <a class="footnote-reference" href="#id10" id="id6">[4]</a>; the motivation for including VMSError was that
it could be raised by third-party packages.</p>
</div>
<div class="section" id="interpreter-core">
<h2><a class="toc-backref" href="#id42">Interpreter core</a></h2>
<p>Handling of PYTHONSTARTUP raises IOError (but the error gets discarded):</p>
<pre class="literal-block">
$ PYTHONSTARTUP=foox ./python
Python 3.2a0 (py3k:82920M, Jul 16 2010, 22:53:23)
[GCC 4.4.3] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
Could not open PYTHONSTARTUP
IOError: [Errno 2] No such file or directory: 'foox'
</pre>
<p><tt class="docutils literal">PyObject_Print()</tt> raises IOError when ferror() signals an error on the
<cite>FILE *</cite> parameter (which, in the source tree, is always either stdout or
stderr).</p>
<p>Unicode encoding and decoding using the <tt class="docutils literal">mbcs</tt> encoding can raise
WindowsError for some error conditions.</p>
</div>
<div class="section" id="standard-library">
<h2><a class="toc-backref" href="#id43">Standard library</a></h2>
<div class="section" id="bz2">
<h3><a class="toc-backref" href="#id44">bz2</a></h3>
<p>Raises IOError throughout (OSError is unused):</p>
<pre class="literal-block">
&gt;&gt;&gt; bz2.BZ2File(&quot;foox&quot;, &quot;rb&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 2] No such file or directory
&gt;&gt;&gt; bz2.BZ2File(&quot;LICENSE&quot;, &quot;rb&quot;).read()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: invalid data stream
&gt;&gt;&gt; bz2.BZ2File(&quot;/tmp/zzz.bz2&quot;, &quot;wb&quot;).read()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: file is not ready for reading
</pre>
</div>
<div class="section" id="curses">
<h3><a class="toc-backref" href="#id45">curses</a></h3>
<p>Not examined.</p>
</div>
<div class="section" id="dbm-gnu-dbm-ndbm">
<h3><a class="toc-backref" href="#id46">dbm.gnu, dbm.ndbm</a></h3>
<p>_dbm.error and _gdbm.error inherit from IOError:</p>
<pre class="literal-block">
&gt;&gt;&gt; dbm.gnu.open(&quot;foox&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
_gdbm.error: [Errno 2] No such file or directory
</pre>
</div>
<div class="section" id="fcntl">
<h3><a class="toc-backref" href="#id47">fcntl</a></h3>
<p>Raises IOError throughout (OSError is unused).</p>
</div>
<div class="section" id="imp-module">
<h3><a class="toc-backref" href="#id48">imp module</a></h3>
<p>Raises IOError for bad file descriptors:</p>
<pre class="literal-block">
&gt;&gt;&gt; imp.load_source(&quot;foo&quot;, &quot;foo&quot;, 123)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 9] Bad file descriptor
</pre>
</div>
<div class="section" id="io-module">
<h3><a class="toc-backref" href="#id49">io module</a></h3>
<p>Raises IOError when trying to open a directory under Unix:</p>
<pre class="literal-block">
&gt;&gt;&gt; open(&quot;Python/&quot;, &quot;r&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 21] Is a directory: 'Python/'
</pre>
<p>Raises IOError or io.UnsupportedOperation (which inherits from the former)
for unsupported operations:</p>
<pre class="literal-block">
&gt;&gt;&gt; open(&quot;LICENSE&quot;).write(&quot;bar&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: not writable
&gt;&gt;&gt; io.StringIO().fileno()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
io.UnsupportedOperation: fileno
&gt;&gt;&gt; open(&quot;LICENSE&quot;).seek(1, 1)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: can't do nonzero cur-relative seeks
</pre>
<p>Raises either IOError or TypeError when the inferior I/O layer misbehaves
(i.e. violates the API it is expected to implement).</p>
<p>Raises IOError when the underlying OS resource becomes invalid:</p>
<pre class="literal-block">
&gt;&gt;&gt; f = open(&quot;LICENSE&quot;)
&gt;&gt;&gt; os.close(f.fileno())
&gt;&gt;&gt; f.read()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 9] Bad file descriptor
</pre>
<p>...or for implementation-specific optimizations:</p>
<pre class="literal-block">
&gt;&gt;&gt; f = open(&quot;LICENSE&quot;)
&gt;&gt;&gt; next(f)
'A. HISTORY OF THE SOFTWARE\n'
&gt;&gt;&gt; f.tell()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: telling position disabled by next() call
</pre>
<p>Raises BlockingIOError (inheriting from IOError) when a call on a non-blocking
object would block.</p>
</div>
<div class="section" id="mmap">
<h3><a class="toc-backref" href="#id50">mmap</a></h3>
<p>Under Unix, raises its own <tt class="docutils literal">mmap.error</tt> (inheriting from EnvironmentError)
throughout:</p>
<pre class="literal-block">
&gt;&gt;&gt; mmap.mmap(123, 10)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
mmap.error: [Errno 9] Bad file descriptor
&gt;&gt;&gt; mmap.mmap(os.open(&quot;/tmp&quot;, os.O_RDONLY), 10)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
mmap.error: [Errno 13] Permission denied
</pre>
<p>Under Windows, however, it mostly raises WindowsError (the source code
also shows a few occurrences of <tt class="docutils literal">mmap.error</tt>):</p>
<pre class="literal-block">
&gt;&gt;&gt; fd = os.open(&quot;LICENSE&quot;, os.O_RDONLY)
&gt;&gt;&gt; m = mmap.mmap(fd, 16384)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
WindowsError: [Error 5] AccÃ¨s refusÃ©
&gt;&gt;&gt; sys.last_value.errno
13
&gt;&gt;&gt; errno.errorcode[13]
'EACCES'

&gt;&gt;&gt; m = mmap.mmap(-1, 4096)
&gt;&gt;&gt; m.resize(16384)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
WindowsError: [Error 87] ParamÃ¨tre incorrect
&gt;&gt;&gt; sys.last_value.errno
22
&gt;&gt;&gt; errno.errorcode[22]
'EINVAL'
</pre>
</div>
<div class="section" id="multiprocessing">
<h3><a class="toc-backref" href="#id51">multiprocessing</a></h3>
<p>Not examined.</p>
</div>
<div class="section" id="os-posix">
<h3><a class="toc-backref" href="#id52">os / posix</a></h3>
<p>The <tt class="docutils literal">os</tt> (or <tt class="docutils literal">posix</tt>) module raises OSError throughout, except under
Windows where WindowsError can be raised instead.</p>
</div>
<div class="section" id="ossaudiodev">
<h3><a class="toc-backref" href="#id53">ossaudiodev</a></h3>
<p>Raises IOError throughout (OSError is unused):</p>
<pre class="literal-block">
&gt;&gt;&gt; ossaudiodev.open(&quot;foo&quot;, &quot;r&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 2] No such file or directory: 'foo'
</pre>
</div>
<div class="section" id="readline">
<h3><a class="toc-backref" href="#id54">readline</a></h3>
<p>Raises IOError in various file-handling functions:</p>
<pre class="literal-block">
&gt;&gt;&gt; readline.read_history_file(&quot;foo&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 2] No such file or directory
&gt;&gt;&gt; readline.read_init_file(&quot;foo&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 2] No such file or directory
&gt;&gt;&gt; readline.write_history_file(&quot;/dev/nonexistent&quot;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IOError: [Errno 13] Permission denied
</pre>
</div>
<div class="section" id="select">
<h3><a class="toc-backref" href="#id55">select</a></h3>
<ul class="simple">
<li>select() and poll objects raise <tt class="docutils literal">select.error</tt>, which doesn't inherit from
anything (but poll.modify() raises IOError);</li>
<li>epoll objects raise IOError;</li>
<li>kqueue objects raise both OSError and IOError.</li>
</ul>
<p>As a side-note, not deriving from <tt class="docutils literal">EnvironmentError</tt> means <tt class="docutils literal">select.error</tt>
does not get the useful <tt class="docutils literal">errno</tt> attribute.  User code must check <tt class="docutils literal">args[0]</tt>
instead:</p>
<pre class="literal-block">
&gt;&gt;&gt; signal.alarm(1); select.select([], [], [])
0
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
select.error: (4, 'Interrupted system call')
&gt;&gt;&gt; e = sys.last_value
&gt;&gt;&gt; e
error(4, 'Interrupted system call')
&gt;&gt;&gt; e.errno == errno.EINTR
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: 'error' object has no attribute 'errno'
&gt;&gt;&gt; e.args[0] == errno.EINTR
True
</pre>
</div>
<div class="section" id="signal">
<h3><a class="toc-backref" href="#id56">signal</a></h3>
<p><tt class="docutils literal">signal.ItimerError</tt> inherits from IOError.</p>
</div>
<div class="section" id="socket">
<h3><a class="toc-backref" href="#id57">socket</a></h3>
<p><tt class="docutils literal">socket.error</tt> inherits from IOError.</p>
</div>
<div class="section" id="sys">
<h3><a class="toc-backref" href="#id58">sys</a></h3>
<p><tt class="docutils literal">sys.getwindowsversion()</tt> raises WindowsError with a bogus error number
if the <tt class="docutils literal">GetVersionEx()</tt> call fails.</p>
</div>
<div class="section" id="time">
<h3><a class="toc-backref" href="#id59">time</a></h3>
<p>Raises IOError for internal errors in time.time() and time.sleep().</p>
</div>
<div class="section" id="zipimport">
<h3><a class="toc-backref" href="#id60">zipimport</a></h3>
<p>zipimporter.get_data() can raise IOError.</p>
</div>
</div>
</div>
<div class="section" id="acknowledgments">
<h1><a class="toc-backref" href="#id61">Acknowledgments</a></h1>
<p>Significant input has been received from Nick Coghlan.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id62">References</a></h1>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>&quot;IO module precisions and exception hierarchy&quot;:
<a class="reference external" href="http://mail.python.org/pipermail/python-dev/2009-September/092130.html">http://mail.python.org/pipermail/python-dev/2009-September/092130.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>Discussion of &quot;Removing WindowsError&quot; in <a class="reference external" href="/dev/peps/pep-0348">PEP 348</a>:
<a class="reference external" href="http://www.python.org/dev/peps/pep-0348/#removing-windowserror">http://www.python.org/dev/peps/pep-0348/#removing-windowserror</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[3]</a></td><td>Google Code Search of <tt class="docutils literal">IOError</tt> in Python code: <a class="reference external" href="http://www.google.com/codesearch?q=lang%3Apython%20IOError">around 40000 results</a>;
<tt class="docutils literal">OSError</tt>: <a class="reference external" href="http://www.google.com/codesearch?q=lang%3Apython%20OSError">around 15200 results</a>;
<tt class="docutils literal">EnvironmentError</tt>: <a class="reference external" href="http://www.google.com/codesearch?q=lang%3Apython%20EnvironmentError">around 3000 results</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[4]</a></td><td><a class="reference external" href="http://bugs.python.org/issue614055">http://bugs.python.org/issue614055</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id63">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>



      </div>

      
      <div id="footer">
	<div id="credits">
 	  <a href="/about/website">Website maintained by the Python community</a><br/>
	  <a href="http://www.xs4all.com/" title="Web and email hosting provided by xs4all, Netherlands">hosting by xs4all</a> /
	  <a href="http://www.timparkin.co.uk/" title="Design by Tim Parkin, Yorkshire man, photographer and developer">design by Tim Parkin</a>
	</div>
	Copyright &copy; 1990-2013, <a href='/psf/'>Python Software Foundation</a><br/>
	<a href="/about/legal">Legal Statements</a>
      </div>


    </div>
  </div>
</body>
</html>






