<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>PEP 0437 -- A DSL for specifying signatures, annotations and argument converters</title>
  <meta name="keywords" content="PEP 0437 -- A DSL for specifying signatures, annotations and argument converters" />
  <meta name="description" content="PEP 0437 -- A DSL for specifying signatures, annotations and argument converters" />
  <link rel="alternate" type="application/rss+xml" title="Community Events"
        href="http://www.python.org/channews.rdf" />
  <link rel="alternate" type="application/rss+xml" title="Python Recipes"
        href="http://aspn.activestate.com/ASPN/Cookbook/Python/index_rss" />
  <link rel="alternate" type="application/rss+xml" title="Usergroup News"
        href="http://python-groups.blogspot.com/feeds/posts/default" />
  <link rel="alternate" type="application/rss+xml" title="Python Screencasts"
        href="http://www.showmedo.com/latestVideoFeed/rss2.0?tag=python" />
  <link rel="alternate" type="application/rss+xml" title="Python Podcasts"
        href="http://www.awaretek.com/python/index.xml" />
  <link rel="alternate" type="application/rss+xml" title="Foundation News"
        href="http://feeds.feedburner.com/PythonSoftwareFoundationNews" />
  <link rel="alternate" type="application/rss+xml" title="Python Enhancement Proposals"
        href="http://www.python.org/dev/peps/peps.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Job Opportunities"
        href="http://www.python.org/community/jobs/jobs.rss" />
  <link rel="alternate" type="application/rss+xml" title="Reddit Feed of Python What's New Online"
        href="http://www.reddit.com/r/Python/.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Insider"
        href="http://feeds.feedburner.com/PythonInsider" />

  <link rel="stylesheet" type="text/css" media="screen" id="screen-switcher-stylesheet"
        href="/styles/screen-switcher-default.css" />
  <link rel="stylesheet" type="text/css" media="sc&#82;een"
        href="/styles/netscape4.css" />
  <link rel="stylesheet" type="text/css" media="print"
        href="/styles/print.css" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/largestyles.css" title="large text" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/defaultfonts.css" title="default fonts" />

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search under the www.python.org Domain"
        href="/search-pysite.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Wiki"
        href="/search-pywiki.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within Python Books at Google Book Search"
        href="/search-pybooks.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Documentation"
        href="/search-pydocs.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for a Module in the Standard Library"
        href="/search-pymodules.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for Packages inside the Cheeseshop (PyPI)"
        href="/search-pycheese.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search Archives of the Main Python Mailing List"
        href="/search-pythonlist.xml"/>

  <script type="text/javascript" src="/js/iotbs2-key-directors-load.js"></script>
  <script type="text/javascript" src="/js/iotbs2-directors.js"></script>
  <script type="text/javascript" src="/js/iotbs2-core.js"></script>

</head>


<body>
  <!-- Logo -->
  <h1 id="logoheader">
    <a href="/" id="logolink" accesskey="1"><img id="logo" src="/images/python-logo.gif" alt="homepage" border="0" /></a>
  </h1>
  <!-- Skip to Navigation -->
  <div class="skiptonav"><a href="#left-hand-navigation" accesskey="2"><img src="/images/trans.gif" id="skiptonav" alt="skip to navigation" border="0" /></a></div>
  <div class="skiptonav"><a href="#content-body" accesskey="3"><img src="/images/trans.gif" id="skiptocontent" alt="skip to content" border="0" /></a></div>
  <!-- Utility Menu -->
  <div id="utility-menu">
    <!-- Search Box -->
    <div id="searchbox">
      <form method="get" action="http://google.com/search" id="searchform" name="searchform">
        <div id="search">
          <input type="hidden" id="domains" name="domains" value="www.python.org" />
          <input type="hidden" id="sitesearch" name="sitesearch" value="www.python.org" />
          <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
          <input type="text" class="input-text" name="q" id="q" />
          <input type="submit" value="search" class="input-button" name="submit" id="submit" />
          <a href="/search" class="reference">Advanced Search</a>
        </div>
      </form>
    </div>
    <div id="screen-switcher"></div>
  </div>

  <div id="left-hand-navigation">
    <!-- Main Menu -->
    <div id="menu">
      <ul class="level-one">
            <li>
          <a href="/about/" title="About The Python Language">About</a>
        </li>
            <li>
          <a href="/news/" title="Major Happenings Within the Python Community">News</a>
        </li>
            <li>
          <a href="/doc/" title="Tutorials, Library Reference, C API">Documentation</a>
        </li>
            <li>
          <a href="/download/" title="Start Running Python Under Windows, Mac, Linux and Others">Download</a>
        </li>
            <li>
          <a href="/getit/" title="Alternate Download page for China">ä¸è½½</a>
        </li>
            <li>
          <a href="/community/" title="Mailing Lists, Jobs, Conferences, SIGs, Online Chats">Community</a>
        </li>
            <li>
          <a href="/psf/" title="Python Software Foundation">Foundation</a>
        </li>
            <li>
          <a href="http://docs.python.org/devguide/" title="Development of the Python language and website">Core Development</a>
        </li>
      </ul>
    </div>

    <!-- Quick Links -->
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/">Python Wiki</a></h4>
    <h4><a style="margin-top:1.5em" href="http://blog.python.org/">Python Insider Blog</a></h4>
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/Python2orPython3">Python 2 or 3?</a></h4>
    <h4><a style="color:#D58228; margin-top:1.5em" href="/psf/donations/">Help Fund Python</a></h4>
    <div style="align:center; padding-top: 0.5em; padding-left: 1em">
      <a href="/psf/donations/"><img width="116" height="42" src="/images/donate.png" alt="" title="" /></a>
    </div>
    <div style="align:center; padding-top: 0.5em; padding-left: 2.5em">
            <a href="http://wiki.python.org/moin/Languages"><img
	      style="align:center"
              width="94" height="46"
	      src="/images/worldmap.jpg" alt="[Python resources in languages other than English]" /></a>
    </div>
    <div style="align:center; padding-top: 0.0em; padding-left: 0em">
       <h4><a href="http://wiki.python.org/moin/Languages">Non-English Resources</a></h4>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Release%20Schedule&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com/public/basic.ics">
                Python Release Schedule iCal Calendar
            </a>
        </iframe>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Events%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com/public/basic.ics">
                Python Events iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=User%20Group%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com&amp;color=%23125A12&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com/public/basic.ics">
                Python User Group iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
  </div>

  <div id="content-body">
    <div id="body-main">
      <div id="content">
        
          <div id="breadcrumb">
               <a href="/dev/peps/">PEP Index</a>
               <span class="breadcrumb-separator">&gt;</span>
            
            PEP 0437 -- A DSL for specifying signatures, annotations and argument converters
          </div>



        <!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">0437</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">A DSL for specifying signatures, annotations and argument converters</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">25d09d4bc90d</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="http://hg.python.org/peps/file/tip/pep-0437.txt">2013-05-18 17:30:25 +1000 (Sat, 18 May 2013)</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Stefan Krah &lt;skrah&#32;&#97;t&#32;bytereef.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">2013-03-11</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.4</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="http://mail.python.org/pipermail/python-dev/2013-May/126117.html">http://mail.python.org/pipermail/python-dev/2013-May/126117.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id7">Abstract</a></li>
<li><a class="reference internal" href="#rejection-notice" id="id8">Rejection Notice</a></li>
<li><a class="reference internal" href="#rationale" id="id9">Rationale</a></li>
<li><a class="reference internal" href="#scope" id="id10">Scope</a></li>
<li><a class="reference internal" href="#dsl-overview" id="id11">DSL overview</a><ul>
<li><a class="reference internal" href="#type-safety-and-annotations" id="id12">Type safety and annotations</a></li>
<li><a class="reference internal" href="#include-converters-h" id="id13">Include/converters.h</a></li>
<li><a class="reference internal" href="#function-specifications" id="id14">Function specifications</a><ul>
<li><a class="reference internal" href="#keyword-arguments" id="id15">Keyword arguments</a><ul>
<li><a class="reference internal" href="#define-block" id="id16">Define block</a></li>
<li><a class="reference internal" href="#declaration" id="id17">Declaration</a></li>
<li><a class="reference internal" href="#c-declarations" id="id18">C-declarations</a></li>
<li><a class="reference internal" href="#cleanup" id="id19">Cleanup</a></li>
<li><a class="reference internal" href="#output" id="id20">Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#positional-only-arguments" id="id21">Positional-only arguments</a></li>
<li><a class="reference internal" href="#left-and-right-optional-arguments" id="id22">Left and right optional arguments</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#flexibility-in-formatting" id="id23">Flexibility in formatting</a></li>
<li><a class="reference internal" href="#benefits-of-a-compact-notation" id="id24">Benefits of a compact notation</a></li>
<li><a class="reference internal" href="#easy-validation-of-the-definition" id="id25">Easy validation of the definition</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id26">Reference implementation</a></li>
<li><a class="reference internal" href="#grammar" id="id27">Grammar</a></li>
<li><a class="reference internal" href="#comparison-with-pep-436" id="id28">Comparison with PEP 436</a></li>
<li><a class="reference internal" href="#copyright" id="id29">Copyright</a></li>
<li><a class="reference internal" href="#references-and-footnotes" id="id30">References and Footnotes</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id7">Abstract</a></h1>
<p>The Python C-API currently has no mechanism for specifying and auto-generating
function signatures, annotations or custom argument converters.</p>
<p>There are several possible approaches to the problem. Cython uses <em>cdef</em>
definitions in <em>.pyx</em> files to generate the required information. However,
CPython's C-API functions often require additional initialization and
cleanup snippets that would be hard to specify in a <em>cdef</em>.</p>
<p><a class="reference external" href="/dev/peps/pep-0436">PEP 436</a> proposes a domain specific language (DSL) enclosed in C comments
that largely resembles a per-parameter configuration file. A preprocessor
reads the comment and emits an argument parsing function, docstrings and
a header for the function that utilizes the results of the parsing step.</p>
<p>The latter function is subsequently referred to as the <em>implementation
function</em>.</p>
</div>
<div class="section" id="rejection-notice">
<h1><a class="toc-backref" href="#id8">Rejection Notice</a></h1>
<p>This PEP was rejected by Guido van Rossum at PyCon US 2013. However, several
of the specific issues raised by this PEP were taken into account when
designing the <a class="reference external" href="http://hg.python.org/peps/rev/a2fa10b2424b">second iteration of the PEP 436 DSL</a> <a class="footnote-reference" href="#id5" id="id6">[3]</a>.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id9">Rationale</a></h1>
<p>Opinions differ regarding the suitability of the <a class="reference external" href="/dev/peps/pep-0436">PEP 436</a> DSL in the context
of a C file. This PEP proposes an alternative DSL. The specific issues with
<a class="reference external" href="/dev/peps/pep-0436">PEP 436</a> that spurred the counter proposal will be explained in the final
section of this PEP.</p>
</div>
<div class="section" id="scope">
<h1><a class="toc-backref" href="#id10">Scope</a></h1>
<p>The PEP focuses exclusively on the DSL. Topics like the output locations of
docstrings or the generated code are outside the scope of this PEP.</p>
<p>It is however vital that the DSL is suitable for generating custom argument
parsers, a feature that is already implemented in Cython.  Therefore, one of
the goals of this PEP is to keep the DSL close to existing solutions, thus
facilitating a possible inclusion of the relevant parts of Cython into the
CPython source tree.</p>
</div>
<div class="section" id="dsl-overview">
<h1><a class="toc-backref" href="#id11">DSL overview</a></h1>
<div class="section" id="type-safety-and-annotations">
<h2><a class="toc-backref" href="#id12">Type safety and annotations</a></h2>
<p>A conversion from a Python to a C value is fully defined by the type of
the converter function.  The PyArg_Parse* family of functions accepts
custom converters in addition to the well-known default converters &quot;i&quot;,
&quot;f&quot;, etc.</p>
<p>This PEP views the default converters as abstract functions, regardless
of how they are actually implemented.</p>
</div>
<div class="section" id="include-converters-h">
<h2><a class="toc-backref" href="#id13">Include/converters.h</a></h2>
<p>Converter functions must be forward-declared. All converter functions
shall be entered into the file Include/converters.h. The file is read
by the preprocessor prior to translating .c files. This is an excerpt:</p>
<pre class="literal-block">
/*[converter]
##### Default converters #####
&quot;s&quot;:  str                                -&gt; const char *res;
&quot;s*&quot;: [str, bytes, bytearray, rw_buffer] -&gt; Py_buffer &amp;res;
[...]
&quot;es#&quot;: str -&gt; (const char *res_encoding, char **res, Py_ssize_t *res_length);
[...]
##### Custom converters #####
path_converter:           [str, bytes, int]  -&gt; path_t &amp;res;
OS_STAT_DIR_FD_CONVERTER: [int, None]        -&gt; int res;
[converter_end]*/
</pre>
<p>Converters are specified by their name, Python input type(s) and C output
type(s).  Default converters must have quoted names, custom converters must
have regular names.  A Python type is given by its name. If a function accepts
multiple Python types, the set is written in list form.</p>
<p>Since the default converters may have multiple implicit return values,
the C output type(s) are written according to the following convention:</p>
<p>The main return value must be named <em>res</em>. This is a placeholder for
the actual variable name given later in the DSL. Additional implicit
return values must be prefixed by <em>res_</em>.</p>
<p>By default the variables are passed by value to the implementation function.
If the address should be passed instead, <em>res</em> must be prefixed with an
ampersand.</p>
<p>Additional declarations may be placed into .c files. Duplicate declarations
are allowed as long as the function types are identical.</p>
<p>It is encouraged to declare custom converter types a second time right
above the converter function definition. The preprocessor will then catch
any mismatch between the declarations.</p>
<p>In order to keep the converter complexity manageable, PY_SSIZE_T_CLEAN will
be deprecated and Py_ssize_t will be assumed for all length arguments.</p>
<p>TBD: Make a list of fantasy types like <em>rw_buffer</em>.</p>
</div>
<div class="section" id="function-specifications">
<h2><a class="toc-backref" href="#id14">Function specifications</a></h2>
<div class="section" id="keyword-arguments">
<h3><a class="toc-backref" href="#id15">Keyword arguments</a></h3>
<p>This example contains the definition of os.stat. The individual sections will
be explained in detail. Grammatically, the whole define block consists of a
function specification and an output section. The function specification in
turn consists of a declaration section, an optional C-declaration section and
an optional cleanup code section.  Sections within the function specification
are separated in yacc style by '%%':</p>
<pre class="literal-block">
/*[define posix_stat]
def os.stat(path: path_converter, *, dir_fd: OS_STAT_DIR_FD_CONVERTER = None,
            follow_symlinks: &quot;p&quot; = True) -&gt; os.stat_result: pass
%%
path_t path = PATH_T_INITIALIZE(&quot;stat&quot;, 0, 1);
int dir_fd = DEFAULT_DIR_FD;
int follow_symlinks = 1;
%%
path_cleanup(&amp;path);
[define_end]*/

&lt;literal C output&gt;

/*[define_output_end]*/
</pre>
<div class="section" id="define-block">
<h4><a class="toc-backref" href="#id16">Define block</a></h4>
<p>The function specification block starts with a <tt class="docutils literal"><span class="pre">/*[define</span></tt> token, followed
by an optional C function name, followed by a right bracket. If the C function
name is not given, it is generated from the declaration name. In the example,
omitting the name <em>posix_stat</em> would result in a C function name of <em>os_stat</em>.</p>
</div>
<div class="section" id="declaration">
<h4><a class="toc-backref" href="#id17">Declaration</a></h4>
<p>The required declaration is (almost) a valid Python function definition. The
'def' keyword and the function body are redundant, but the author of this PEP
finds the definition more readable if they are present.</p>
<p>The function name may be a path instead of a plain identifier. Each argument
is annotated with the name of the converter function that will be applied to it.</p>
<p>Default values are given in the usual Python manner and may be any valid
Python expression.</p>
<p>The return value may be any Python expression. Usually it will be the name
of an object, but alternative return values could be specified in list form.</p>
</div>
<div class="section" id="c-declarations">
<h4><a class="toc-backref" href="#id18">C-declarations</a></h4>
<p>This optional section contains C variable declarations. Since the converter
functions have been declared beforehand, the preprocessor can type-check
the declarations.</p>
</div>
<div class="section" id="cleanup">
<h4><a class="toc-backref" href="#id19">Cleanup</a></h4>
<p>The optional cleanup section contains literal C code that will be inserted
unmodified after the implementation function.</p>
</div>
<div class="section" id="output">
<h4><a class="toc-backref" href="#id20">Output</a></h4>
<p>The output section contains the code emitted by the preprocessor.</p>
</div>
</div>
<div class="section" id="positional-only-arguments">
<h3><a class="toc-backref" href="#id21">Positional-only arguments</a></h3>
<p>Functions that do not take keyword arguments are indicated by the presence
of the <em>slash</em> special parameter:</p>
<pre class="literal-block">
/*[define stat_float_times]
def os.stat_float_times(/, newval: &quot;i&quot;) -&gt; os.stat_result: pass
%%
int newval = -1;
[define_end]*/
</pre>
<p>The preprocessor translates this definition to a PyArg_ParseTuple() call.
All arguments to the right of the slash are optional arguments.</p>
</div>
<div class="section" id="left-and-right-optional-arguments">
<h3><a class="toc-backref" href="#id22">Left and right optional arguments</a></h3>
<p>Some legacy functions contain optional arguments groups both to the left and
right of a central parameter. It is debatable whether a new tool should support
such functions.  For completeness' sake, this is the proposed syntax:</p>
<pre class="literal-block">
/*[define]
def curses.window.addch(y: &quot;i&quot;, x: &quot;i&quot;, ch: &quot;O&quot;, attr: &quot;l&quot;) -&gt; None: pass
where groups = [[ch], [ch, attr], [y, x, ch], [y, x, ch, attr]]
[define_end]*/
</pre>
<p>Here <em>ch</em> is the central parameter, <em>attr</em> can optionally be added on the
right, and the group [y, x] can optionally be added on the left.</p>
<p>Essentially the rule is that all ordered combinations of the central
parameter and the optional groups must be possible such that no two
combinations have the same length.</p>
<p>This is concisely expressed by putting the central parameter first in
the list and subsequently adding the optional arguments groups to the
left and right.</p>
</div>
</div>
</div>
<div class="section" id="flexibility-in-formatting">
<h1><a class="toc-backref" href="#id23">Flexibility in formatting</a></h1>
<p>If the above os.stat example is considered too compact, it can easily be
formatted this way:</p>
<pre class="literal-block">
/*[define posix_stat]
def os.stat(path: path_converter,
            *,
            dir_fd: OS_STAT_DIR_FD_CONVERTER = None,
            follow_symlinks: &quot;p&quot; = True)
-&gt; os.stat_result: pass
%%
path_t path = PATH_T_INITIALIZE(&quot;stat&quot;, 0, 1);
int dir_fd = DEFAULT_DIR_FD;
int follow_symlinks = 1;
%%
path_cleanup(&amp;path);
[define_end]*/

&lt;literal C output&gt;

/*[define_output_end]*/
</pre>
</div>
<div class="section" id="benefits-of-a-compact-notation">
<h1><a class="toc-backref" href="#id24">Benefits of a compact notation</a></h1>
<p>The advantages of a concise notation are especially obvious when a large
number of parameters is involved. The argument parsing part of
<tt class="docutils literal">_posixsubprocess.fork_exec</tt> is fully specified by this definition:</p>
<pre class="literal-block">
/*[define subprocess_fork_exec]
def _posixsubprocess.fork_exec(
    process_args: &quot;O&quot;, executable_list: &quot;O&quot;,
    close_fds: &quot;p&quot;, py_fds_to_keep: &quot;O&quot;,
    cwd_obj: &quot;O&quot;, env_list: &quot;O&quot;,
    p2cread: &quot;i&quot;, p2cwrite: &quot;i&quot;, c2pread: &quot;i&quot;, c2pwrite: &quot;i&quot;,
    errread: &quot;i&quot;, errwrite: &quot;i&quot;, errpipe_read: &quot;i&quot;, errpipe_write: &quot;i&quot;,
    restore_signals: &quot;i&quot;, call_setsid: &quot;i&quot;, preexec_fn: &quot;i&quot;, /) -&gt; int: pass
[define_end]*/
</pre>
<p>Note that the <em>preprocess</em> tool currently emits a redundant C-declaration
section for this example, so the output is longer than necessary.</p>
</div>
<div class="section" id="easy-validation-of-the-definition">
<h1><a class="toc-backref" href="#id25">Easy validation of the definition</a></h1>
<p>How can an inexperienced user validate a definition like os.stat? Simply
by changing os.stat to os_stat, defining missing converters and pasting
the definition into the Python interactive interpreter!</p>
<p>In fact, a converters.py module could be auto-generated from converters.h.</p>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id26">Reference implementation</a></h1>
<p>A reference implementation is available at <a class="reference external" href="http://bugs.python.org/issue16612">issue 16612</a> <a class="footnote-reference" href="#id1" id="id2">[1]</a>. Since this PEP
was written under time constraints and the author is unfamiliar with the
PLY toolchain, the software is written in Standard ML and utilizes the
ml-yacc/ml-lex toolchain.</p>
<p>The grammar is conflict-free and available in ml-yacc readable BNF form.</p>
<p>Two tools are available:</p>
<blockquote>
<ul class="simple">
<li><em>printsemant</em> reads a converter header and a .c file and dumps
the semantically checked parse tree to stdout.</li>
<li><em>preprocess</em> reads a converter header and a .c file and dumps
the preprocessed .c file to stdout.</li>
</ul>
</blockquote>
<p>Known deficiencies:</p>
<blockquote>
<ul class="simple">
<li>The Python 'test' expression is not semantically checked. The syntax
however is checked since it is part of the grammar.</li>
<li>The lexer does not handle triple quoted strings.</li>
<li>C declarations are parsed in a primitive way. The final implementation
should utilize 'declarator' and 'init-declarator' from the C grammar.</li>
<li>The <em>preprocess</em> tool does not emit code for the left-and-right optional
arguments case. The <em>printsemant</em> tool can deal with this case.</li>
<li>Since the <em>preprocess</em> tool generates the output from the parse
tree, the original indentation of the define block is lost.</li>
</ul>
</blockquote>
</div>
<div class="section" id="grammar">
<h1><a class="toc-backref" href="#id27">Grammar</a></h1>
<blockquote>
TBD: The grammar exists in ml-yacc readable form, but should probably be
included here in EBNF notation.</blockquote>
</div>
<div class="section" id="comparison-with-pep-436">
<h1>Comparison with <a class="reference external" href="/dev/peps/pep-0436">PEP 436</a></h1>
<p>The author of this PEP has the following concerns about the DSL proposed
in <a class="reference external" href="/dev/peps/pep-0436">PEP 436</a>:</p>
<blockquote>
<ul>
<li><p class="first">The whitespace sensitive configuration file like syntax looks out
of place in a C file.</p>
</li>
<li><p class="first">The structure of the function definition gets lost in the per-parameter
specifications. Keywords like positional-only, required and keyword-only
are scattered across too many different places.</p>
<p>By contrast, in the alternative DSL the structure of the function
definition can be understood at a single glance.</p>
</li>
<li><p class="first">The <a class="reference external" href="/dev/peps/pep-0436">PEP 436</a> DSL has 14 documented flags and at least one undocumented
(allow_fd) flag. Figuring out which of the 2**15 possible combinations
are valid places an unnecessary burden on the user.</p>
<p>Experience with the PEP-3118 buffer flags has shown that sorting out
(and exhaustively testing!) valid combinations is an extremely tedious
task. The PEP-3118 flags are still not well understood by many people.</p>
<p>By contrast, the alternative DSL has a central file Include/converters.h
that can be quickly searched for the desired converter. Many of the
converters are already known, perhaps even memorized by people (due
to frequent use).</p>
</li>
<li><p class="first">The <a class="reference external" href="/dev/peps/pep-0436">PEP 436</a> DSL allows too much freedom. Types can apparently be omitted,
the preprocessor accepts (and ignores) unknown keywords, sometimes adding
white space after a docstring results in an assertion error.</p>
<p>The alternative DSL on the other hand allows no such freedoms. Omitting
converter or return value annotations is plainly a syntax error. The
LALR(1) grammar is unambiguous and specified for the complete translation
unit.</p>
</li>
</ul>
</blockquote>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id29">Copyright</a></h1>
<p>This document is licensed under the <a class="reference external" href="http://www.opencontent.org/openpub/">Open Publication License</a> <a class="footnote-reference" href="#id3" id="id4">[2]</a>.</p>
</div>
<div class="section" id="references-and-footnotes">
<h1><a class="toc-backref" href="#id30">References and Footnotes</a></h1>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td><a class="reference external" href="http://bugs.python.org/issue16612">http://bugs.python.org/issue16612</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td><a class="reference external" href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[3]</a></td><td><a class="reference external" href="http://hg.python.org/peps/rev/a2fa10b2424b">http://hg.python.org/peps/rev/a2fa10b2424b</a></td></tr>
</tbody>
</table>
</div>



      </div>

      
      <div id="footer">
	<div id="credits">
 	  <a href="/about/website">Website maintained by the Python community</a><br/>
	  <a href="http://www.xs4all.com/" title="Web and email hosting provided by xs4all, Netherlands">hosting by xs4all</a> /
	  <a href="http://www.timparkin.co.uk/" title="Design by Tim Parkin, Yorkshire man, photographer and developer">design by Tim Parkin</a>
	</div>
	Copyright &copy; 1990-2013, <a href='/psf/'>Python Software Foundation</a><br/>
	<a href="/about/legal">Legal Statements</a>
      </div>


    </div>
  </div>
</body>
</html>






