<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>PEP 3128 -- BList: A Faster List-like Type</title>
  <meta name="keywords" content="PEP 3128 -- BList: A Faster List-like Type" />
  <meta name="description" content="PEP 3128 -- BList: A Faster List-like Type" />
  <link rel="alternate" type="application/rss+xml" title="Community Events"
        href="http://www.python.org/channews.rdf" />
  <link rel="alternate" type="application/rss+xml" title="Python Recipes"
        href="http://aspn.activestate.com/ASPN/Cookbook/Python/index_rss" />
  <link rel="alternate" type="application/rss+xml" title="Usergroup News"
        href="http://python-groups.blogspot.com/feeds/posts/default" />
  <link rel="alternate" type="application/rss+xml" title="Python Screencasts"
        href="http://www.showmedo.com/latestVideoFeed/rss2.0?tag=python" />
  <link rel="alternate" type="application/rss+xml" title="Python Podcasts"
        href="http://www.awaretek.com/python/index.xml" />
  <link rel="alternate" type="application/rss+xml" title="Foundation News"
        href="http://feeds.feedburner.com/PythonSoftwareFoundationNews" />
  <link rel="alternate" type="application/rss+xml" title="Python Enhancement Proposals"
        href="http://www.python.org/dev/peps/peps.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Job Opportunities"
        href="http://www.python.org/community/jobs/jobs.rss" />
  <link rel="alternate" type="application/rss+xml" title="Reddit Feed of Python What's New Online"
        href="http://www.reddit.com/r/Python/.rss" />
  <link rel="alternate" type="application/rss+xml" title="Python Insider"
        href="http://feeds.feedburner.com/PythonInsider" />

  <link rel="stylesheet" type="text/css" media="screen" id="screen-switcher-stylesheet"
        href="/styles/screen-switcher-default.css" />
  <link rel="stylesheet" type="text/css" media="sc&#82;een"
        href="/styles/netscape4.css" />
  <link rel="stylesheet" type="text/css" media="print"
        href="/styles/print.css" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/largestyles.css" title="large text" />
  <link rel="alternate stylesheet" type="text/css" media="screen"
        href="/styles/defaultfonts.css" title="default fonts" />

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search under the www.python.org Domain"
        href="/search-pysite.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Wiki"
        href="/search-pywiki.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within Python Books at Google Book Search"
        href="/search-pybooks.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within the Python Documentation"
        href="/search-pydocs.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for a Module in the Standard Library"
        href="/search-pymodules.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search for Packages inside the Cheeseshop (PyPI)"
        href="/search-pycheese.xml"/>

  <link rel="search" type="application/opensearchdescription+xml"
        title="Search Archives of the Main Python Mailing List"
        href="/search-pythonlist.xml"/>

  <script type="text/javascript" src="/js/iotbs2-key-directors-load.js"></script>
  <script type="text/javascript" src="/js/iotbs2-directors.js"></script>
  <script type="text/javascript" src="/js/iotbs2-core.js"></script>

</head>


<body>
  <!-- Logo -->
  <h1 id="logoheader">
    <a href="/" id="logolink" accesskey="1"><img id="logo" src="/images/python-logo.gif" alt="homepage" border="0" /></a>
  </h1>
  <!-- Skip to Navigation -->
  <div class="skiptonav"><a href="#left-hand-navigation" accesskey="2"><img src="/images/trans.gif" id="skiptonav" alt="skip to navigation" border="0" /></a></div>
  <div class="skiptonav"><a href="#content-body" accesskey="3"><img src="/images/trans.gif" id="skiptocontent" alt="skip to content" border="0" /></a></div>
  <!-- Utility Menu -->
  <div id="utility-menu">
    <!-- Search Box -->
    <div id="searchbox">
      <form method="get" action="http://google.com/search" id="searchform" name="searchform">
        <div id="search">
          <input type="hidden" id="domains" name="domains" value="www.python.org" />
          <input type="hidden" id="sitesearch" name="sitesearch" value="www.python.org" />
          <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
          <input type="text" class="input-text" name="q" id="q" />
          <input type="submit" value="search" class="input-button" name="submit" id="submit" />
          <a href="/search" class="reference">Advanced Search</a>
        </div>
      </form>
    </div>
    <div id="screen-switcher"></div>
  </div>

  <div id="left-hand-navigation">
    <!-- Main Menu -->
    <div id="menu">
      <ul class="level-one">
            <li>
          <a href="/about/" title="About The Python Language">About</a>
        </li>
            <li>
          <a href="/news/" title="Major Happenings Within the Python Community">News</a>
        </li>
            <li>
          <a href="/doc/" title="Tutorials, Library Reference, C API">Documentation</a>
        </li>
            <li>
          <a href="/download/" title="Start Running Python Under Windows, Mac, Linux and Others">Download</a>
        </li>
            <li>
          <a href="/getit/" title="Alternate Download page for China">ä¸è½½</a>
        </li>
            <li>
          <a href="/community/" title="Mailing Lists, Jobs, Conferences, SIGs, Online Chats">Community</a>
        </li>
            <li>
          <a href="/psf/" title="Python Software Foundation">Foundation</a>
        </li>
            <li>
          <a href="http://docs.python.org/devguide/" title="Development of the Python language and website">Core Development</a>
        </li>
      </ul>
    </div>

    <!-- Quick Links -->
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/">Python Wiki</a></h4>
    <h4><a style="margin-top:1.5em" href="http://blog.python.org/">Python Insider Blog</a></h4>
    <h4><a style="margin-top:1.5em" href="http://wiki.python.org/moin/Python2orPython3">Python 2 or 3?</a></h4>
    <h4><a style="color:#D58228; margin-top:1.5em" href="/psf/donations/">Help Fund Python</a></h4>
    <div style="align:center; padding-top: 0.5em; padding-left: 1em">
      <a href="/psf/donations/"><img width="116" height="42" src="/images/donate.png" alt="" title="" /></a>
    </div>
    <div style="align:center; padding-top: 0.5em; padding-left: 2.5em">
            <a href="http://wiki.python.org/moin/Languages"><img
	      style="align:center"
              width="94" height="46"
	      src="/images/worldmap.jpg" alt="[Python resources in languages other than English]" /></a>
    </div>
    <div style="align:center; padding-top: 0.0em; padding-left: 0em">
       <h4><a href="http://wiki.python.org/moin/Languages">Non-English Resources</a></h4>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Release%20Schedule&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/b6v58qvojllt0i6ql654r1vh00%40group.calendar.google.com/public/basic.ics">
                Python Release Schedule iCal Calendar
            </a>
        </iframe>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=Events%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com&amp;color=%23B1365F&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/j7gov1cmnqr9tvg14k621j7t5c%40group.calendar.google.com/public/basic.ics">
                Python Events iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
    <div class="calendar">
        <iframe src="https://www.google.com/calendar/embed?title=User%20Group%20Calendar&amp;showNav=0&amp;showDate=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=300&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com&amp;color=%23125A12&amp;" style=" border-width:0 " width="180" height="300" frameborder="0" scrolling="no">
            <a href="http://www.google.com/calendar/ical/3haig2m9msslkpf2tn1h56nn9g%40group.calendar.google.com/public/basic.ics">
                Python User Group iCal Calendar
            </a>
        </iframe>
        <p class="level-one"><a href="http://pycon.org/#calendar">Add an event</a> to this calendar.</p>
    </div>
  </div>

  <div id="content-body">
    <div id="body-main">
      <div id="content">
        
          <div id="breadcrumb">
               <a href="/dev/peps/">PEP Index</a>
               <span class="breadcrumb-separator">&gt;</span>
            
            PEP 3128 -- BList: A Faster List-like Type
          </div>



        <!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">3128</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">BList: A Faster List-like Type</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">19b5d7ac40a7</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="http://hg.python.org/peps/file/tip/pep-3128.txt">2008-12-16 03:52:16 +0000 (Tue, 16 Dec 2008)</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Daniel Stutzbach &lt;daniel&#32;&#97;t&#32;stutzbachenterprises.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Discussions-To:</th><td class="field-body">Python 3000 List &lt;<a class="reference external" href="mailto:python-3000&#64;python.org?subject=PEP%203128">python-3000&#32;&#97;t&#32;python.org</a>&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">30-Apr-2007</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.6 and/or 3.0</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">30-Apr-2007</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#rejection-notice" id="id10">Rejection Notice</a></li>
<li><a class="reference internal" href="#abstract" id="id11">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id12">Motivation</a></li>
<li><a class="reference internal" href="#use-case-trade-offs" id="id13">Use Case Trade-offs</a></li>
<li><a class="reference internal" href="#implementation" id="id14">Implementation</a></li>
<li><a class="reference internal" href="#memory-usage" id="id15">Memory Usage</a></li>
<li><a class="reference internal" href="#backwards-compatibility" id="id16">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id17">Reference Implementation</a><ul>
<li><a class="reference internal" href="#porting-to-other-python-variants" id="id18">Porting to Other Python Variants</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discussion" id="id19">Discussion</a></li>
<li><a class="reference internal" href="#on-going-tasks" id="id20">On-going Tasks</a></li>
<li><a class="reference internal" href="#references" id="id21">References</a></li>
<li><a class="reference internal" href="#copyright" id="id22">Copyright</a></li>
</ul>
</div>
<div class="section" id="rejection-notice">
<h1><a class="toc-backref" href="#id10">Rejection Notice</a></h1>
<p>Rejected based on Raymond Hettinger's sage advice <a class="footnote-reference" href="#id9" id="id1">[4]</a>:</p>
<blockquote>
<p>After looking at the source, I think this has almost zero chance
for replacing list().  There is too much value in a simple C API,
low space overhead for small lists, good performance is common use
cases, and having performance that is easily understood.  The
BList implementation lacks these virtues and it trades-off a little
performance in common cases in for much better performance in
uncommon cases.  As a Py3.0 PEP, I think it can be rejected.</p>
<p>Depending on its success as a third-party module, it still has a
chance for inclusion in the collections module.  The essential
criteria for that is whether it is a superior choice for some
real-world use cases.  I've scanned my own code and found no instances
where BList would have been preferable to a regular list.  However,
that scan has a selection bias because it doesn't reflect what I would
have written had BList been available.  So, after a few months, I
intend to poll comp.lang.python for BList success stories.  If they
exist, then I have no problem with inclusion in the collections
module.  After all, its learning curve is near zero -- the only cost
is the clutter factor stemming from indecision about the most
appropriate data structure for a given task.</p>
</blockquote>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id11">Abstract</a></h1>
<p>The common case for list operations is on small lists.  The current
array-based list implementation excels at small lists due to the
strong locality of reference and infrequency of memory allocation
operations.  However, an array takes O(n) time to insert and delete
elements, which can become problematic as the list gets large.</p>
<p>This PEP introduces a new data type, the BList, that has array-like
and tree-like aspects.  It enjoys the same good performance on small
lists as the existing array-based implementation, but offers superior
asymptotic performance for most operations.  This PEP proposes
replacing the makes two mutually exclusive proposals for including the
BList type in Python:</p>
<ol class="arabic simple">
<li>Add it to the collections module, or</li>
<li>Replace the existing list type</li>
</ol>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id12">Motivation</a></h1>
<p>The BList grew out of the frustration of needing to rewrite intuitive
algorithms that worked fine for small inputs but took O(n**2) time for
large inputs due to the underlying O(n) behavior of array-based lists.
The deque type, introduced in Python 2.4, solved the most common
problem of needing a fast FIFO queue.  However, the deque type doesn't
help if we need to repeatedly insert or delete elements from the
middle of a long list.</p>
<p>A wide variety of data structure provide good asymptotic performance
for insertions and deletions, but they either have O(n) performance
for other operations (e.g., linked lists) or have inferior performance
for small lists (e.g., binary trees and skip lists).</p>
<p>The BList type proposed in this PEP is based on the principles of
B+Trees, which have array-like and tree-like aspects.  The BList
offers array-like performance on small lists, while offering O(log n)
asymptotic performance for all insert and delete operations.
Additionally, the BList implements copy-on-write under-the-hood, so
even operations like getslice take O(log n) time.  The table below
compares the asymptotic performance of the current array-based list
implementation with the asymptotic performance of the BList.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="36%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Operation</th>
<th class="head">Array-based list</th>
<th class="head">BList</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Copy</td>
<td>O(n)</td>
<td><strong>O(1)</strong></td>
</tr>
<tr><td>Append</td>
<td><strong>O(1)</strong></td>
<td>O(log n)</td>
</tr>
<tr><td>Insert</td>
<td>O(n)</td>
<td><strong>O(log n)</strong></td>
</tr>
<tr><td>Get Item</td>
<td><strong>O(1)</strong></td>
<td>O(log n)</td>
</tr>
<tr><td>Set Item</td>
<td><strong>O(1)</strong></td>
<td><strong>O(log n)</strong></td>
</tr>
<tr><td>Del Item</td>
<td>O(n)</td>
<td><strong>O(log n)</strong></td>
</tr>
<tr><td>Iteration</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr><td>Get Slice</td>
<td>O(k)</td>
<td><strong>O(log n)</strong></td>
</tr>
<tr><td>Del Slice</td>
<td>O(n)</td>
<td><strong>O(log n)</strong></td>
</tr>
<tr><td>Set Slice</td>
<td>O(n+k)</td>
<td><strong>O(log k + log n)</strong></td>
</tr>
<tr><td>Extend</td>
<td>O(k)</td>
<td><strong>O(log k + log n)</strong></td>
</tr>
<tr><td>Sort</td>
<td>O(n log n)</td>
<td>O(n log n)</td>
</tr>
<tr><td>Multiply</td>
<td>O(nk)</td>
<td><strong>O(log k)</strong></td>
</tr>
</tbody>
</table>
<p>An extensive empirical comparison of Python's array-based list and the
BList are available at <a class="footnote-reference" href="#id7" id="id2">[2]</a>.</p>
</div>
<div class="section" id="use-case-trade-offs">
<h1><a class="toc-backref" href="#id13">Use Case Trade-offs</a></h1>
<p>The BList offers superior performance for many, but not all,
operations.  Choosing the correct data type for a particular use case
depends on which operations are used.  Choosing the correct data type
as a built-in depends on balancing the importance of different use
cases and the magnitude of the performance differences.</p>
<p>For the common uses cases of small lists, the array-based list and the
BList have similar performance characteristics.</p>
<p>For the slightly less common case of large lists, there are two common
uses cases where the existing array-based list outperforms the
existing BList reference implementation.  These are:</p>
<ol class="arabic simple">
<li>A large LIFO stack, where there are many .append() and .pop(-1)
operations.  Each operation is O(1) for an array-based list, but
O(log n) for the BList.</li>
<li>A large list that does not change size.  The getitem and setitem
calls are O(1) for an array-based list, but O(log n) for the BList.</li>
</ol>
<p>In performance tests on a 10,000 element list, BLists exhibited a 50%
and 5% increase in execution time for these two uses cases,
respectively.</p>
<p>The performance for the LIFO use case could be improved to O(n) time,
by caching a pointer to the right-most leaf within the root node.  For
lists that do not change size, the common case of sequential access
could also be improved to O(n) time via caching in the root node.
However, the performance of these approaches has not been empirically
tested.</p>
<p>Many operations exhibit a tremendous speed-up (O(n) to O(log n)) when
switching from the array-based list to BLists.  In performance tests
on a 10,000 element list, operations such as getslice, setslice, and
FIFO-style insert and deletes on a BList take only 1% of the time
needed on array-based lists.</p>
<p>In light of the large performance speed-ups for many operations, the
small performance costs for some operations will be worthwhile for
many (but not all) applications.</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id14">Implementation</a></h1>
<p>The BList is based on the B+Tree data structure.  The BList is a wide,
bushy tree where each node contains an array of up to 128 pointers to
its children.  If the node is a leaf, its children are the
user-visible objects that the user has placed in the list.  If node is
not a leaf, its children are other BList nodes that are not
user-visible.  If the list contains only a few elements, they will all
be a children of single node that is both the root and a leaf.  Since
a node is little more than array of pointers, small lists operate in
effectively the same way as an array-based data type and share the
same good performance characteristics.</p>
<p>The BList maintains a few invariants to ensure good (O(log n))
asymptotic performance regardless of the sequence of insert and delete
operations.  The principle invariants are as follows:</p>
<ol class="arabic simple">
<li>Each node has at most 128 children.</li>
<li>Each non-root node has at least 64 children.</li>
<li>The root node has at least 2 children, unless the list contains
fewer than 2 elements.</li>
<li>The tree is of uniform depth.</li>
</ol>
<p>If an insert would cause a node to exceed 128 children, the node
spawns a sibling and transfers half of its children to the sibling.
The sibling is inserted into the node's parent.  If the node is the
root node (and thus has no parent), a new parent is created and the
depth of the tree increases by one.</p>
<p>If a deletion would cause a node to have fewer than 64 children, the
node moves elements from one of its siblings if possible.  If both of
its siblings also only have 64 children, then two of the nodes merge
and the empty one is removed from its parent.  If the root node is
reduced to only one child, its single child becomes the new root
(i.e., the depth of the tree is reduced by one).</p>
<p>In addition to tree-like asymptotic performance and array-like
performance on small-lists, BLists support transparent
<strong>copy-on-write</strong>.  If a non-root node needs to be copied (as part of
a getslice, copy, setslice, etc.), the node is shared between multiple
parents instead of being copied.  If it needs to be modified later, it
will be copied at that time.  This is completely behind-the-scenes;
from the user's point of view, the BList works just like a regular
Python list.</p>
</div>
<div class="section" id="memory-usage">
<h1><a class="toc-backref" href="#id15">Memory Usage</a></h1>
<p>In the worst case, the leaf nodes of a BList have only 64 children
each, rather than a full 128, meaning that memory usage is around
twice that of a best-case array implementation.  Non-leaf nodes use up
a negligible amount of additional memory, since there are at least 63
times as many leaf nodes as non-leaf nodes.</p>
<p>The existing array-based list implementation must grow and shrink as
items are added and removed.  To be efficient, it grows and shrinks
only when the list has grow or shrunk exponentially.  In the worst
case, it, too, uses twice as much memory as the best case.</p>
<p>In summary, the BList's memory footprint is not significantly
different from the existing array-based implementation.</p>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id16">Backwards Compatibility</a></h1>
<p>If the BList is added to the collections module, backwards
compatibility is not an issue.  This section focuses on the option of
replacing the existing array-based list with the BList.  For users of
the Python interpreter, a BList has an identical interface to the
current list-implementation.  For virtually all operations, the
behavior is identical, aside from execution speed.</p>
<p>For the C API, BList has a different interface than the existing
list-implementation.  Due to its more complex structure, the BList
does not lend itself well to poking and prodding by external sources.
Thankfully, the existing list-implementation defines an API of
functions and macros for accessing data from list objects.  Google
Code Search suggests that the majority of third-party modules uses the
well-defined API rather than relying on the list's structure
directly.  The table below summarizes the search queries and results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Search String</th>
<th class="head">Number of Results</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>PyList_GetItem</td>
<td>2,000</td>
</tr>
<tr><td>PySequence_GetItem</td>
<td>800</td>
</tr>
<tr><td>PySequence_Fast_GET_ITEM</td>
<td>100</td>
</tr>
<tr><td>PyList_GET_ITEM</td>
<td>400</td>
</tr>
<tr><td>[^a-zA-Z_]ob_item</td>
<td>100</td>
</tr>
</tbody>
</table>
<p>This can be achieved in one of two ways:</p>
<ol class="arabic">
<li><p class="first">Redefine the various accessor functions and macros in listobject.h
to access a BList instead.  The interface would be unchanged.  The
functions can easily be redefined.  The macros need a bit more care
and would have to resort to function calls for large lists.</p>
<p>The macros would need to evaluate their arguments more than once,
which could be a problem if the arguments have side effects.  A
Google Code Search for &quot;PyList_GET_ITEM([^)]+(&quot; found only a
handful of cases where this occurs, so the impact appears to be
low.</p>
<p>The few extension modules that use list's undocumented structure
directly, instead of using the API, would break.  The core code
itself uses the accessor macros fairly consistently and should be
easy to port.</p>
</li>
<li><p class="first">Deprecate the existing list type, but continue to include it.
Extension modules wishing to use the new BList type must do so
explicitly.  The BList C interface can be changed to match the
existing PyList interface so that a simple search-replace will be
sufficient for 99% of module writers.</p>
<p>Existing modules would continue to compile and work without change,
but they would need to make a deliberate (but small) effort to
migrate to the BList.</p>
<p>The downside of this approach is that mixing modules that use
BLists and array-based lists might lead to slow down if conversions
are frequently necessary.</p>
</li>
</ol>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id17">Reference Implementation</a></h1>
<p>A reference implementations of the BList is available for CPython at <a class="footnote-reference" href="#id6" id="id3">[1]</a>.</p>
<p>The source package also includes a pure Python implementation,
originally developed as a prototype for the CPython version.
Naturally, the pure Python version is rather slow and the asymptotic
improvements don't win out until the list is quite large.</p>
<p>When compiled with Py_DEBUG, the C implementation checks the
BList invariants when entering and exiting most functions.</p>
<p>An extensive set of test cases is also included in the source package.
The test cases include the existing Python sequence and list test
cases as a subset.  When the interpreter is built with Py_DEBUG, the
test cases also check for reference leaks.</p>
<div class="section" id="porting-to-other-python-variants">
<h2><a class="toc-backref" href="#id18">Porting to Other Python Variants</a></h2>
<p>If the BList is added to the collections module, other Python variants
can support it in one of three ways:</p>
<ol class="arabic simple">
<li>Make blist an alias for list.  The asymptotic performance won't be
as good, but it'll work.</li>
<li>Use the pure Python reference implementation.  The performance for
small lists won't be as good, but it'll work.</li>
<li>Port the reference implementation.</li>
</ol>
</div>
</div>
<div class="section" id="discussion">
<h1><a class="toc-backref" href="#id19">Discussion</a></h1>
<p>This proposal has been discussed briefly on the Python-3000 mailing
list <a class="footnote-reference" href="#id8" id="id4">[3]</a>.  Although a number of people favored the proposal, there
were also some objections.  Below summarizes the pros and cons as
observed by posters to the thread.</p>
<p>General comments:</p>
<ul class="simple">
<li>Pro: Will outperform the array-based list in most cases</li>
<li>Pro: &quot;I've implemented variants of this ... a few different times&quot;</li>
<li>Con: Desirability and performance in actual applications is unproven</li>
</ul>
<p>Comments on adding BList to the collections module:</p>
<ul class="simple">
<li>Pro: Matching the list-API reduces the learning curve to near-zero</li>
<li>Pro: Useful for intermediate-level users; won't get in the way of beginners</li>
<li>Con: Proliferation of data types makes the choices for developers harder.</li>
</ul>
<p>Comments on replacing the array-based list with the BList:</p>
<ul class="simple">
<li>Con: Impact on extension modules (addressed in <a class="reference internal" href="#backwards-compatibility">Backwards
Compatibility</a>)</li>
<li>Con: The use cases where BLists are slower are important
(see <a class="reference internal" href="#use-case-trade-offs">Use Case Trade-Offs</a> for how these might be addressed).</li>
<li>Con: The array-based list code is simple and easy to maintain</li>
</ul>
<p>To assess the desirability and performance in actual applications,
Raymond Hettinger suggested releasing the BList as an extension module
(now available at <a class="footnote-reference" href="#id6" id="id5">[1]</a>).  If it proves useful, he felt it would be a
strong candidate for inclusion in 2.6 as part of the collections
module.  If widely popular, then it could be considered for replacing
the array-based list, but not otherwise.</p>
<p>Guido van Rossum commented that he opposed the proliferation of data
types, but favored replacing the array-based list if backwards
compatibility could be addressed and the BList's performance was
uniformly better.</p>
</div>
<div class="section" id="on-going-tasks">
<h1><a class="toc-backref" href="#id20">On-going Tasks</a></h1>
<ul class="simple">
<li>Reduce the memory footprint of small lists</li>
<li>Implement TimSort for BLists, so that best-case sorting is O(n)
instead of O(log n).</li>
<li>Implement __reversed__</li>
<li>Cache a pointer in the root to the rightmost leaf, to make LIFO
operation O(n) time.</li>
</ul>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id21">References</a></h1>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> Reference Implementations for C and Python:
<a class="reference external" href="http://www.python.org/pypi/blist/">http://www.python.org/pypi/blist/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Empirical performance comparison between Python's array-based
list and the blist: <a class="reference external" href="http://stutzbachenterprises.com/blist/">http://stutzbachenterprises.com/blist/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td>Discussion on python-3000 starting at post:
<a class="reference external" href="http://mail.python.org/pipermail/python-3000/2007-April/006757.html">http://mail.python.org/pipermail/python-3000/2007-April/006757.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[4]</a></td><td>Raymond Hettinger's feedback on python-3000:
<a class="reference external" href="http://mail.python.org/pipermail/python-3000/2007-May/007491.html">http://mail.python.org/pipermail/python-3000/2007-May/007491.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id22">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>



      </div>

      
      <div id="footer">
	<div id="credits">
 	  <a href="/about/website">Website maintained by the Python community</a><br/>
	  <a href="http://www.xs4all.com/" title="Web and email hosting provided by xs4all, Netherlands">hosting by xs4all</a> /
	  <a href="http://www.timparkin.co.uk/" title="Design by Tim Parkin, Yorkshire man, photographer and developer">design by Tim Parkin</a>
	</div>
	Copyright &copy; 1990-2013, <a href='/psf/'>Python Software Foundation</a><br/>
	<a href="/about/legal">Legal Statements</a>
      </div>


    </div>
  </div>
</body>
</html>






