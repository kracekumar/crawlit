<!DOCTYPE html>
<script>var __pbpa = true;</script><script>var translated_warning_string = 'Warning: Never enter your Tumblr password unless \u201chttps://www.tumblr.com/login\u201d\x0ais the address in your web browser.\x0a\x0aYou should also see a green \u201cTumblr, Inc.\u201d identification in the address bar.\x0a\x0aSpammers and other bad guys use fake forms to steal passwords.\x0a\x0aTumblr will never ask you to log in from a user\u2019s blog.\x0a\x0aAre you absolutely sure you want to continue?';</script><script type="text/javascript" language="javascript" src="http://assets.tumblr.com/assets/scripts/pre_tumblelog.js?_v=001b252f920c60cde4c95b898217994e"></script>
<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# blog: http://ogp.me/ns/blog#">
    <meta charset="UTF-8">
    <title>Random stream</title>
    <link rel="shortcut icon" href="http://31.media.tumblr.com/avatar_08684c9830f1_128.png">
	<link rel="alternate" type="application/rss+xml" href="http://kracekumar.com/rss">
    
    <meta name="description" content="" />
          
	<meta name="if:Show notes" content="1">
	<meta name="text:Disqus Shortname" content="" />
	<meta name="color:Link Color" content="#EB374B">
	<meta name="color:Link Hover" content="#05b2c2">
	<meta name="color:Post Background" content="#F2F2F2" />
	<link rel="stylesheet" href="http://static.tumblr.com/26l8vc7/X7wmf3p9v/style.css">
	<style type="text/css">
		.post, .cover{background: #F2F2F2;}
		a{color: #EB374B;}
		a:hover, #header h1 a:hover{color:#05b2c2;}
		.date p, .shadow{background: #EB374B;}
		 
	</style>
    <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);
b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
mixpanel.init("4787390884cf94ee4ef5b161840cae15");mixpanel.track(document.title);
</script><!-- end Mixpanel -->

<!-- BEGIN TUMBLR FACEBOOK OPENGRAPH TAGS --><!-- If you'd like to specify your own Open Graph tags, define the og:url and og:title tags in your theme's HTML. --><!-- Read more: http://ogp.me/ --><meta property="fb:app_id" content="48119224995" /><meta property="og:title" content="Random stream" /><meta property="og:url" content="http://kracekumar.com/?og=1" /><meta property="og:description" content="kracekumar - Geek" /><meta property="og:type" content="tumblr-feed:tumblelog" /><meta property="og:image" content="http://31.media.tumblr.com/avatar_08684c9830f1_128.png" /><!-- END TUMBLR FACEBOOK OPENGRAPH TAGS -->


<!-- TWITTER TAGS --><meta charset="utf-8"><meta name="twitter:site" content="tumblr" /><meta name="twitter:card" content="summary" /><meta name="twitter:title" content="kracekumar" /><meta name="twitter:description" content="kracekumar - Geek" /><meta name="twitter:creator" content="kracetheking" /><meta name="twitter:app:name:iphone" content="Tumblr" /><meta name="twitter:app:name:ipad" content="Tumblr" /><meta name="twitter:app:name:googleplay" content="Tumblr" /><meta name="twitter:app:id:iphone" content="305343404" /><meta name="twitter:app:id:ipad" content="305343404" /><meta name="twitter:app:id:googleplay" content="com.tumblr" /><meta name="twitter:app:url:iphone" content="tumblr://x-callback-url/blog?blogName=kracekumar&amp;referrer=twitter-cards" /><meta name="twitter:app:url:ipad" content="tumblr://x-callback-url/blog?blogName=kracekumar&amp;referrer=twitter-cards" /><meta name="twitter:app:url:googleplay" content="tumblr://x-callback-url/blog?blogName=kracekumar&amp;referrer=twitter-cards" />

<script src="http://assets.tumblr.com/assets/scripts/tumblelog.js?_v=5f870c646bc8380d871857a3aa781cf3"></script>
<meta http-equiv="x-dns-prefetch-control" content="off"/>
<meta name="keywords" content="requests,sachin,GOD,cloudant,couchdb" />
</head>
<body>
	<div id="wrapper">
		<div id="header" role="banner">
			<h1><a href="/">Random stream</a></h1>
			
			
			<div id="description">
				<p>kracekumar - Geek</p>
			</div>
			
		</div>
		
		<div id="navigation">			
			<div class="wrapper">
				 
				<ul class="pages links" role="navigation">
					
					<li><a href="/aboutme">self.__intro__</a></li>
					
					<li><a href="/resume">Resume</a></li>
					                    
				</ul>
				
				
				<form id="search" role="search" action="/search" method="get">
					<input type="text" name="q" class="search" value="Search" onfocus="if(this.value == this.defaultValue) this.value = ''" onblur="if(!this.value) this.value = this.defaultValue" />
				</form>
			</div>
		</div>
		
		<div id="content" role="main">
    		
    
    
    
    
			
			
					
					<div class="post text">
						 
						<div class="date">
							<p><span class="day">19</span> 3 / 2012</p>
						</div>
						
						
						<div class="content">
							
							<h2 class="link"><a href="http://kracekumar.com/post/19556427690/n00bs-epic-research-on-twitters-streaming-api-on">n00b&#8217;s epic research on twitter&#8217;s streaming api on sachin</a></h2>
							
		
							<p>I am on the way to launch my tweetpie(python twitter library built on top of requests), streaming api work was on progress, I tried `statuses/filter` found connection was on going for a very long time. Then decided to put the code  on my production web server and analyse it.</p>
<p>Actual script</p>
<blockquote>
<pre>import requests<br/>import json<br/>import couchdbkit<br/><br/>class Tweet(couchdbkit.Document):
    user = couchdbkit.StringProperty()
    created_at = couchdbkit.StringProperty()
    text = couchdbkit.StringProperty()

def store_live_tweets():
    track = ['sachin', 'sachinism', 'Sachin', 'Sachinism', 'tendulkar', \
             'Tendulkar', 'sachintendulkar','SachinTendulkar']
    s = couchdbkit.Server("https://username:password@username.cloudant.com")
    d = couchdbkit.Database("https://username:password@username.cloudant.com/db")
    Tweet.set_db(d)
    r = requests.post('https://stream.twitter.com/1/statuses/filter.json',
    data={'track': track}, auth=('username', 'password'))
    for line in r.iter_lines():
        if line:
            result = json.loads(line)
            tweet = Tweet(user = result['user']['name'], \
            created_at = result['created_at'],
            text = result['text'])
            tweet.save()

if __name__ == '__main__':
    try:
        store_live_tweets()

    except Exception as e:
        with open('sachin_log.txt', 'a') as f:
        f.write(e.message)
<br/><br/><br/></pre>
</blockquote>
<p>The program is simple python(even if you don&#8217;t know python it doesn&#8217;t matter, its equal to plain english). requests, json, couchdbkit is used. Tweet class has three attributes text, user, created_at are mapped with fetched tweet. requests is used to fetch the tweets from twitter and details are stored in couchdb(google for more). cloudant is used since there is a free plan and I want to test their service.</p>
<p>Why to track = [&#8216;sachin&#8217;]&#160;?</p>
<p>" When sachin bats against pakistan number of people watching the match in television is greater than Europe&#8217;s population" - This is proved.</p>
<p><strong>Analysis</strong></p>
<p>LAST TWEET<br/>&#8212;&#8212;&#8212;&#8212;&#8212;<br/>created_at: Sun Mar 18&#160;19:2<br/>text: &#8220;In the defence of sachin: When I started a blog f&#8221;<br/>user: New Globa<br/><br/>FIRST_TWEET<br/>&#8212;&#8212;&#8212;&#8212;&#8212;-<br/>creatd_at: Sun Mar 18&#160;14:5<br/>text: &#8220;I feel bad that d entire nation still banks on sachin fo&#8221;<br/>user: sandy aka</p>
<p>Twitter servers are located in San Francisco, So assumption is created_at fleld is San Francisco time stamp.</p>
<p><br/>Time difference between India Time Zone and San Francisco: 12.30 ahead(India)</p>
<p><br/>Total tweets retrieved: 8003</p>
<p><br/>Total time script was run(connection was closed by twitter): almost one hour</p>
<p>Script Started at :20.00PM(IST), San Francisco time 7.30AM.</p>
<p>Now it seems twitter stores user time stamp.</p>
<p><strong>Why only 8003 tweets are retrieved?</strong></p>
<p>According to docs only 1% of real time tweets are delivered, after 8003 tweets the program was rerun, response content was 200 but no data was received.</p>
<p>[EDIT]</p>
<p>Questions:</p>
<ul><li>Does twitter have time limit for open connection and close?</li>
</ul><p>     <strong> Answer</strong>: You can leave a connection open for as long as you like/can. Server restarts happen and you can cause yourself to get disconnected by falling behind on the stream (not being able to computationally keep up with the volume being sent to you). Make sure that your code expects disconnects and error conditions and that you back off appropriately.</p>

<ul><li>How does 1% real time tweet is determined?</li>
</ul><p><strong>Answer:</strong> When using filter, you&#8217;ll get all the tweets matching your terms if the sum of tweets you would receive in a given second would be less than 1% of the total content of the public firehose. If all the tweets about &#8220;sachin&#8221; made up less than 1% of the total, you&#8217;d get all the tweets. If &#8220;sachin&#8221; became popular enough to account for more than 1% of the firehose total, you&#8217;ll get the tweets up to that 1% along with rate limit messages telling you how many you missed</p>
<ul><li>What time stamp is stored for created_at in tweet?</li>
</ul><p><strong>Answer:</strong> The created_at timestamp on tweets is in UTC format</p>
<p>Thanks to <a href="http://twitter.com/episod" target="_blank">http://twitter.com/episod</a></p>
<p>Next Research:</p>
<ul><li>Continue the same test with time bound(tweets between time range).</li>
</ul><p>After reading <strong>`j2labs`</strong> post  - <a href="http://j2labs.tumblr.com/post/6929393728/a-twitter-nozzle-class" target="_blank">http://j2labs.tumblr.com/post/6929393728/a-twitter-nozzle-class</a> of same research and few feed back from reddit community, modification were done to my code(<a href="https://gist.github.com/2130913" target="_blank">https://gist.github.com/2130913</a>)</p>
<blockquote>
<pre>import requests
import time
import json
import zmq
from multiprocessing import Process
import couchdbkit


s = couchdbkit.Server("https://usr:passwd@usr.cloudant.com")
db = couchdbkit.Database("https://usr:passwd@usr.cloudant.com/db")

def worker():
    context = zmq.Context()
    work_receiver = context.socket(zmq.PULL)
    work_receiver.connect("tcp://127.0.0.1:5557")
    while 1:
        d = json.loads(work_receiver.recv())
        try:
            db.save_doc(doc=d)
        except Exception as e:
            with open('sachin_omq_log.txt','a') as f:
                msg = " ".join([e.message, " ", time.ctime(), "\n"])
                f.write(msg)
        

def store_live_tweets():
    Process(target=worker, args=()).start()
    context = zmq.Context()
    send = context.socket(zmq.PUSH)
    send.bind("tcp://127.0.0.1:5557")
    track = ['sachin', 'sachinism', 'Sachin', 'Sachinism', 'tendulkar', 'Tendulkar', 'sachintendulkar','SachinTendulkar']
    r = requests.post('https://stream.twitter.com/1/statuses/filter.json',
        data={'track': track}, auth=('usr', 'passwd'))
    for line in r.iter_lines():
        if line:
            print line
            send.send(line)

if __name__ == '__main__':
    try:
        store_live_tweets()
    except Exception as e:
        with open('sachin_omq_log.txt', 'a') as f:
            msg = " ".join([e.message, " ", time.ctime(), "\n"])
            f.write(msg)




</pre>

</blockquote>
<p>After modification, cloudant account was able to receive 1.6req/sec to 3.2req/sec, my test was carried out in web faction shared hosting plan.</p>
<p>I would be glad if any one can perform same test on aws and rackspace, can provide result for minimum 10 mins results. </p>
						</div>
						
						<div class="info">							
							 
								<div>
									<p class="tags-label">Tags:</p>
									<ul class="tags">
										<li><a href="http://kracekumar.com/tagged/python">python</a></li><li><a href="http://kracekumar.com/tagged/twitter-streamin-api">twitter-streamin-api</a></li><li><a href="http://kracekumar.com/tagged/twitter">twitter</a></li><li><a href="http://kracekumar.com/tagged/couchdb">couchdb</a></li><li><a href="http://kracekumar.com/tagged/cloudant">cloudant</a></li><li><a href="http://kracekumar.com/tagged/requests">requests</a></li><li><a href="http://kracekumar.com/tagged/sachin">sachin</a></li><li><a href="http://kracekumar.com/tagged/GOD">GOD</a></li>
									</ul>
								</div>
							
							<p><a href="http://kracekumar.com/post/19556427690/n00bs-epic-research-on-twitters-streaming-api-on">Permalink</a> <a href="http://kracekumar.com/post/19556427690/n00bs-epic-research-on-twitters-streaming-api-on#notes"><span class="notes">1 note</span></a> <span style="float: right;"><a class="dsq-comment-count" href="http://kracekumar.com/post/19556427690/n00bs-epic-research-on-twitters-streaming-api-on#disqus_thread"></a></span></p>
						</div>
						 
						<!--[if IE]><div class="date-shadow ie-rotate"><![endif]-->
						<!--[if !IE]><!--><div class="date-shadow"><!--<![endif]-->
							<span class="cover"></span>
							<span class="shadow"></span>
							<span class="darker"></span>
						</div>
						
					</div>
					

					
					
					
					
					

					
					
					
					
					
					

		
		
		
		
		
					

					
					
					
					

					
					
					
					
					

					
					
					
					
					
					

					
					
					
					
					


            
                
            
			
						
			
			
			
			
			
			
			
		</div>				
	</div>

	
	<div id="footer">
		<div class="wrapper">
			<ul class="links" role="navigation">
				<li><a href="/archive">Archive</a></li>
				
                <li><a href="/ask">Ask me anything</a></li>
                
				<li><a href="http://kracekumar.com/rss">RSS</a></li>
			</ul>
			<p class="info-theme" role="contentinfo">Powered by <a href="http://www.tumblr.com">Tumblr</a> and designed by <a href="http://kcmr.tumblr.com">Kcmr</a>.</p>
		</div>
	</div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-28499341-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
    
        <script>
            (function() {
                var links = document.getElementsByTagName('a');
                var query = '?';
                for(var i = 0; i < links.length; i++) {
                    if(links[i].href.indexOf('#disqus_thread') >= 0) {
                        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
                    }
                }
                document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/oolai/get_num_replies.js' + query + '"></' + 'script>');
            })();
        </script>
    
<!-- BEGIN TUMBLR CODE --><iframe id="tumblr_controls" width="1" height="1" frameborder="0" scrolling="no" style="position:absolute; z-index:2147483647; top:0; right:0; border:0; background-color:transparent; overflow:hidden; " src="http://assets.tumblr.com/assets/html/iframe/o.html?_v=7f3ccc52344f6f4db744590e355db381#src=http%3A%2F%2Fkracekumar.com%2Ftagged%2Ftwitter&amp;lang=en_US&amp;name=kracekumar&amp;avatar=http%3A%2F%2F31.media.tumblr.com%2Favatar_08684c9830f1_64.png&amp;title=Random+stream&amp;url=http%3A%2F%2Fkracekumar.com%2F&amp;page_slide=slide"></iframe><div id="teaser_iframe_container" style="display:none;"><iframe scrolling="no" frameborder="0" src="http://www.tumblr.com/assets/html/iframe/teaser.html#src=http%3A%2F%2Fkracekumar.com%2Ftagged%2Ftwitter&amp;lang=en_US&amp;name=kracekumar&amp;avatar=http%3A%2F%2F31.media.tumblr.com%2Favatar_08684c9830f1_64.png&amp;title=Random+stream&amp;url=http%3A%2F%2Fkracekumar.com%2F&amp;page_slide=slide" id="teaser_iframe" width="1" height="1"></iframe></div><script type="text/javascript">
    (function(Tumblr){
        var follow_iframe_initialized = false;
        if (Tumblr.FollowTeaser && Tumblr.PostMessageListener) {
            // Don't do anything until the first initialize event
            Tumblr.PostMessageListener.initialize(function(message, origin) {
                if (follow_iframe_initialized || message.length < 2) return;

                if (message[0] === 'follow_iframe' && message[1] === 'enable') {
                    Tumblr.FollowTeaser.current_page = 1;
                    Tumblr.FollowTeaser.infer_infinite_scroll = true;
                    Tumblr.FollowTeaser.create_from_tumblr_controls("http:\/\/assets.tumblr.com\/assets\/html\/iframe\/follow.html?_v=5e68f8079f31e083bf6f7ba6a7b4a52a");
                    Tumblr.FollowTeaser.scroll_listener(true);
                    follow_iframe_initialized = true;
                }
            });
        }
    })(this.Tumblr || (this.Tumblr = {}));
</script><!--[if IE]><script type="text/javascript">document.getElementById('tumblr_controls').allowTransparency=true;</script><![endif]--><iframe onload="javascript:this.contentWindow.postMessage(['tick_google_analytics', '/tagged/twitter?route=%2Ftagged%2F%3Atag'].join(';'), this.src.split('/analytics.html')[0]);  COMSCORE = true;this.contentWindow.postMessage('enable_comscore;' + window.location, this.src.split('/analytics.html')[0]);" src="http://assets.tumblr.com/analytics.html?dfe9b9d3e783ff1f12fd8ce1b733bdc0" scrolling="no" width="1" height="1" frameborder="0" style="background-color:transparent; overflow:hidden; position:absolute; top:0; left:0 z-index:9999;" id="ga_target"></iframe><script type="text/javascript">
      var _qevents = _qevents || [];

      (function() {
       var elem = document.createElement('script');

       elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
       elem.async = true;
       elem.type = "text/javascript";
       var scpt = document.getElementsByTagName('script')[0];
       scpt.parentNode.insertBefore(elem, scpt);
      })();
    </script><script type="text/javascript">
        _qevents.push( { qacct: 'p-19UtqE8ngoZbM' } );
    </script><noscript><div style="display: none;"><img src="//pixel.quantserve.com/pixel/'p-19UtqE8ngoZbM'.gif" height="1" width="1" alt="Quantcast"/></div></noscript><script type="text/javascript">!function(s){s.src='http://www.tumblr.com/impixu?T=1386440179&J=eyJ0eXBlIjoidXJsIiwidXJsIjoiaHR0cDpcL1wva3JhY2VrdW1hci5jb21cL3RhZ2dlZFwvdHdpdHRlciIsInJlcXR5cGUiOjAsInJvdXRlIjoiXC90YWdnZWRcLzp0YWcifQ==&U=BEKDEPMJOC&K=02f0a8288180cfac4f8c8b9e40bed1f62c2fc01db9a3c9f2b90d571f2a01b0f8&R='.replace(/&R=[^&$]*/,'').concat('&R='+escape(document.referrer)).slice(0,2000).replace(/%.?.?$/,'');}(new Image());</script><noscript><img style="position:absolute;z-index:-3334;top:0px;left:0px;visibility:hidden;" src="http://www.tumblr.com/impixu?T=1386440179&J=eyJ0eXBlIjoidXJsIiwidXJsIjoiaHR0cDpcL1wva3JhY2VrdW1hci5jb21cL3RhZ2dlZFwvdHdpdHRlciIsInJlcXR5cGUiOjAsInJvdXRlIjoiXC90YWdnZWRcLzp0YWciLCJub3NjcmlwdCI6MX0=&U=BEKDEPMJOC&K=a61cd7da1a97b47a343234c185de358c16f7a86f8703142ef97f59946ba98e64&R="></noscript><script type="text/javascript">!function(s){s.src='http://www.tumblr.com/impixu?T=1386440179&J=eyJ0eXBlIjoicG9zdCIsInVybCI6Imh0dHA6XC9cL2tyYWNla3VtYXIuY29tXC90YWdnZWRcL3R3aXR0ZXIiLCJyZXF0eXBlIjowLCJyb3V0ZSI6IlwvdGFnZ2VkXC86dGFnIiwicG9zdHMiOlt7InBvc3RpZCI6IjE5NTU2NDI3NjkwIiwiYmxvZ2lkIjoiNTY1MTEwOCIsInNvdXJjZSI6MzN9XX0=&U=BNLNBIICAC&K=ea445b3dc604669f8a3de87761af4852752fd211239f2993c861250d44e92b89&R='.replace(/&R=[^&$]*/,'').concat('&R='+escape(document.referrer)).slice(0,2000).replace(/%.?.?$/,'');}(new Image());</script><noscript><img style="position:absolute;z-index:-3334;top:0px;left:0px;visibility:hidden;" src="http://www.tumblr.com/impixu?T=1386440179&J=eyJ0eXBlIjoicG9zdCIsInVybCI6Imh0dHA6XC9cL2tyYWNla3VtYXIuY29tXC90YWdnZWRcL3R3aXR0ZXIiLCJyZXF0eXBlIjowLCJyb3V0ZSI6IlwvdGFnZ2VkXC86dGFnIiwicG9zdHMiOlt7InBvc3RpZCI6IjE5NTU2NDI3NjkwIiwiYmxvZ2lkIjoiNTY1MTEwOCIsInNvdXJjZSI6MzN9XSwibm9zY3JpcHQiOjF9&U=BNLNBIICAC&K=f87b1c4a43cf7b0f47956d6ad6416f59e4220fd65f6e6b08e13df54427e08466&R="></noscript><script type="text/javascript" src="http://l.yimg.com/ss/rapid-3.9.js"></script><script>
                    (function(YAHOO) {
                        if (YAHOO) {
                            YAHOO.i13n.beacon_server = 'nol.yahoo.com';
                            var keys = { pd:'/tagged/:tag', _li:0, i_rad:0, i_strm:0 };
                            YAHOO.rapid = new YAHOO.i13n.Rapid({spaceid:1197719232, oo:1, client_only:1, yql_enabled:false, keys:keys});
                        }
                    })(window.YAHOO);
                </script><!-- END TUMBLR CODE -->

</body>
</html>