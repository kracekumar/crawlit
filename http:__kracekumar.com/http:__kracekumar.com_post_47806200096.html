<!DOCTYPE html>
<script>var __pbpa = true;</script><script>var translated_warning_string = 'Warning: Never enter your Tumblr password unless \u201chttps://www.tumblr.com/login\u201d\x0ais the address in your web browser.\x0a\x0aYou should also see a green \u201cTumblr, Inc.\u201d identification in the address bar.\x0a\x0aSpammers and other bad guys use fake forms to steal passwords.\x0a\x0aTumblr will never ask you to log in from a user\u2019s blog.\x0a\x0aAre you absolutely sure you want to continue?';</script><script type="text/javascript" language="javascript" src="http://assets.tumblr.com/assets/scripts/pre_tumblelog.js?_v=001b252f920c60cde4c95b898217994e"></script>
<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# blog: http://ogp.me/ns/blog#">
    <meta charset="UTF-8">
    <title>hardest feature request - Random stream</title>
    <link rel="shortcut icon" href="http://31.media.tumblr.com/avatar_08684c9830f1_128.png">
	<link rel="alternate" type="application/rss+xml" href="http://kracekumar.com/rss">
    
    <meta name="description" content="hardest feature request I was working on Hgtv feature, syncing slides and videos, when video is viewed slide changes automatically. Seems easy but guess what someone has to take pain to watch entire..." />
          
	<meta name="if:Show notes" content="1">
	<meta name="text:Disqus Shortname" content="" />
	<meta name="color:Link Color" content="#EB374B">
	<meta name="color:Link Hover" content="#05b2c2">
	<meta name="color:Post Background" content="#F2F2F2" />
	<link rel="stylesheet" href="http://static.tumblr.com/26l8vc7/X7wmf3p9v/style.css">
	<style type="text/css">
		.post, .cover{background: #F2F2F2;}
		a{color: #EB374B;}
		a:hover, #header h1 a:hover{color:#05b2c2;}
		.date p, .shadow{background: #EB374B;}
		 
	</style>
    <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);
b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
mixpanel.init("4787390884cf94ee4ef5b161840cae15");mixpanel.track(document.title);
</script><!-- end Mixpanel -->

<!-- BEGIN TUMBLR FACEBOOK OPENGRAPH TAGS --><!-- If you'd like to specify your own Open Graph tags, define the og:url and og:title tags in your theme's HTML. --><!-- Read more: http://ogp.me/ --><meta property="fb:app_id" content="48119224995" /><meta property="og:site_name" content="Random stream" /><meta property="og:title" content="hardest feature request" /><meta property="og:url" content="http://kracekumar.com/post/47806200096/hardest-feature-request" /><meta property="og:description" content="I was working on Hgtv feature, syncing slides and videos, when video is viewed slide changes automatically. Seems easy but guess what someone has to take pain to watch entire video and collect the..." /><meta property="og:determiner" content="a" /><meta property="og:type" content="tumblr-feed:entry" /><meta property="og:image" content="http://assets.tumblr.com/images/og/text_200.png" /><!-- END TUMBLR FACEBOOK OPENGRAPH TAGS -->


<!-- TWITTER TAGS --><meta charset="utf-8"><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="I was working on Hgtv feature, syncing slides and videos, when video is viewed slide changes automatically. Seems easy but guess what someone has to take pain to watch entire video and collect the details about timings of the video and slide number . Then pass on the info to presentz.js which syncs video and slides.

Iframe

 If you look into source code how slide show and video is inserted, it is iframe. All videos are from youtube, slides are from speakerdeck, slideshare. Now to sync video and slide, I need to fetch the  slide number and current time of video. Youtube has js api, which was easy to figure, but speakerdeck and slideshare inserts images into iframe. When next button is clicked image is changed. If I can access DOM I am done, but unfortunately you cannot access the DOM of an Iframe for a Cross Origin Request. I found this info after one whole day of tinkering and trying all answers in stackoverflow. Then I looked into presentz JS how it handles slide changing. Speakerdeck receives postMessage, it accepts nextSlide, previousSlide, goToSlide messages. Once speakerdeck processed the messages and sends message to originator, and the received message has to be processed(window.addEventListener). Before figuring above messages I was brute forcing to get figure out how to get current slide. Once I figured it only accepts three message, then it was easy. Below is the code.

    var receiveMessage = function(event){
    var data;
    if (event.origin.indexOf(&quot;speakerdeck.com&quot;) === -1){
      if (event.origin.indexOf(&quot;slideshare.net&quot;) === -1){
        return;
      }
    }
    data = &#36;.parseJSON(event.data);
    if (data[1]) {
      slideno = data[1].number;
    }};


 Then register event listener

window.addEventListener(&quot;message&quot;, receiveMessage, false);


 Then slideshare was bit out of track. Slideshare had js api which requires swfobject and swfobject_playerapi. Then it was bit easier still took me some time to figure out missing swfobject_playerapi is required.

 It took me five days to finally get this feature and pull is ready.

Learning:

 I learned coffeescript.
 Parsing DOM of Iframe is not possible for CORS.
 postMessage
 This feature was so far the hardest one.

Root Cause

 The root cause for this problem, is my **Ass u mption **. I was trying to use presentz.js to get current slide and video player timings." /><meta name="twitter:title" content="hardest feature request " /><meta name="twitter:url" content="http://kracekumar.com/post/47806200096/hardest-feature-request" /><meta name="twitter:site" content="tumblr" /><meta name="twitter:creator" content="kracetheking" /><meta name="twitter:app:name:iphone" content="Tumblr" /><meta name="twitter:app:name:ipad" content="Tumblr" /><meta name="twitter:app:name:googleplay" content="Tumblr" /><meta name="twitter:app:id:iphone" content="305343404" /><meta name="twitter:app:id:ipad" content="305343404" /><meta name="twitter:app:id:googleplay" content="com.tumblr" /><meta name="twitter:app:url:iphone" content="tumblr://x-callback-url/blog?blogName=kracekumar&amp;postID=47806200096&amp;referrer=twitter-cards" /><meta name="twitter:app:url:ipad" content="tumblr://x-callback-url/blog?blogName=kracekumar&amp;postID=47806200096&amp;referrer=twitter-cards" /><meta name="twitter:app:url:googleplay" content="tumblr://x-callback-url/blog?blogName=kracekumar&amp;postID=47806200096&amp;referrer=twitter-cards" />

<script src="http://assets.tumblr.com/assets/scripts/tumblelog.js?_v=5f870c646bc8380d871857a3aa781cf3"></script>
<meta http-equiv="x-dns-prefetch-control" content="off"/>
<meta name="keywords" content="iframe,facepalm,javascript" />
</head>
<body>
	<div id="wrapper">
		<div id="header" role="banner">
			<h1><a href="/">Random stream</a></h1>
			
			
			<div id="description">
				<p>kracekumar - Geek</p>
			</div>
			
		</div>
		
		<div id="navigation">			
			<div class="wrapper">
				 
				<ul class="pages links" role="navigation">
					
					<li><a href="/aboutme">self.__intro__</a></li>
					
					<li><a href="/resume">Resume</a></li>
					                    
				</ul>
				
				
				<form id="search" role="search" action="/search" method="get">
					<input type="text" name="q" class="search" value="Search" onfocus="if(this.value == this.defaultValue) this.value = ''" onblur="if(!this.value) this.value = this.defaultValue" />
				</form>
			</div>
		</div>
		
		<div id="content" role="main">
    		
    
    
    
    
			
			
					
					<div class="post text">
						 
						<div class="date">
							<p><span class="day">13</span> 4 / 2013</p>
						</div>
						
						
						<div class="content">
							
							<h2 class="link"><a href="http://kracekumar.com/post/47806200096/hardest-feature-request">hardest feature request </a></h2>
							
		
							<p>I was working on <a href="http://hasgeek.tv" target="_blank">Hgtv</a> feature, syncing <code>slides</code> and <code>videos</code>, when video is viewed slide changes automatically. Seems easy but guess what someone has to take pain to watch entire video and collect the details about timings of the video and slide number . Then pass on the info to <a href="https://github.com/ffissore/presentz.js" target="_blank">presentz.js</a> which syncs video and slides.</p>

<h2>Iframe</h2>

<p>If you look into source code how slide show and video is inserted, it is iframe. All videos are from <code>youtube</code>, slides are from <code>speakerdeck</code>, <code>slideshare</code>. Now to sync video and slide, I need to fetch the  slide number and current time of video. <code>Youtube</code> has js api, which was easy to figure, but speakerdeck and slideshare inserts images into iframe. When next button is clicked image is changed. If I can access DOM I am done, but unfortunately you cannot access the DOM of an Iframe for a Cross Origin Request. I found this info after one whole day of tinkering and trying all answers in stackoverflow. Then I looked into presentz JS how it handles slide changing. Speakerdeck receives postMessage, it accepts <code>nextSlide</code>, <code>previousSlide</code>, <code>goToSlide</code> messages. Once speakerdeck processed the messages and sends message to originator, and the received message has to be processed(<code>window.addEventListener</code>). Before figuring above messages I was brute forcing to get figure out how to get current slide. Once I figured it only accepts three message, then it was easy. Below is the code.</p>

<pre><code>    var receiveMessage = function(event){
    var data;
    if (event.origin.indexOf("speakerdeck.com") === -1){
      if (event.origin.indexOf("slideshare.net") === -1){
        return;
      }
    }
    data = $.parseJSON(event.data);
    if (data[1]) {
      slideno = data[1].number;
    }};
</code></pre>

<p>Then register event listener</p>

<pre><code>window.addEventListener("message", receiveMessage, false);
</code></pre>

<p>Then slideshare was bit out of track. Slideshare had js api which requires swfobject and swfobject_playerapi. Then it was bit easier still took me some time to figure out missing <code>swfobject_playerapi</code> is required.</p>

<p>It took me five days to finally get this feature and <a href="https://github.com/hasgeek/hasgeek.tv/pull/86" target="_blank">pull</a> is ready.</p>

<h2>Learning:</h2>

<ul><li>I learned coffeescript.</li>
<li>Parsing DOM of Iframe is not possible for CORS.</li>
<li><code>postMessage</code></li>
</ul><p>This feature was so far the hardest one.</p>

<h2>Root Cause</h2>

<p>The root cause for this problem, is my **Ass u mption **. I was trying to use presentz.js to get current slide and video player timings.</p>
						</div>
						
						<div class="info">							
							 
								<div>
									<p class="tags-label">Tags:</p>
									<ul class="tags">
										<li><a href="http://kracekumar.com/tagged/javascript">javascript</a></li><li><a href="http://kracekumar.com/tagged/facepalm">facepalm</a></li><li><a href="http://kracekumar.com/tagged/iframe">iframe</a></li>
									</ul>
								</div>
							
							<p><a href="http://kracekumar.com/post/47806200096/hardest-feature-request">Permalink</a>  <span style="float: right;"><a class="dsq-comment-count" href="http://kracekumar.com/post/47806200096/hardest-feature-request#disqus_thread"></a></span></p>
						</div>
						 
						<!--[if IE]><div class="date-shadow ie-rotate"><![endif]-->
						<!--[if !IE]><!--><div class="date-shadow"><!--<![endif]-->
							<span class="cover"></span>
							<span class="shadow"></span>
							<span class="darker"></span>
						</div>
						
					</div>
					

					
					
					
					
					

					
					
					
					
					
					

		
		
		
		
		
					

					
					
					
					

					
					
					
					
					

					
					
					
					
					
					

					
					
					
					
					


            
                
                    <div class="notecontainer">                    	
                    	
                        <div id="disqus_thread"></div>
                        <script type="text/javascript" src="http://disqus.com/forums/oolai/embed.js"></script>
                        <noscript><a href="http://oolai.disqus.com/?url=ref">View the discussion thread</a></noscript>
                        
                        
                        <div id="notes">
                        	<div class="notes">
                        		
                        	</div>
                        </div>
                    </div>
                
            
			
						
			
			
			
			
			
			
			
			<div id="pagination" role="navigation">
				<p>																										
					
					<a href="http://kracekumar.com/post/47845987199" class="newer">Next post &raquo;</a>
					
					
					
					<a href="http://kracekumar.com/post/46695528573" class="older">&laquo; Previous post</a>
					
				</p>
			</div>
			
		</div>				
	</div>

	
	<div id="footer">
		<div class="wrapper">
			<ul class="links" role="navigation">
				<li><a href="/archive">Archive</a></li>
				
                <li><a href="/ask">Ask me anything</a></li>
                
				<li><a href="http://kracekumar.com/rss">RSS</a></li>
			</ul>
			<p class="info-theme" role="contentinfo">Powered by <a href="http://www.tumblr.com">Tumblr</a> and designed by <a href="http://kcmr.tumblr.com">Kcmr</a>.</p>
		</div>
	</div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-28499341-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
    
        <script>
            (function() {
                var links = document.getElementsByTagName('a');
                var query = '?';
                for(var i = 0; i < links.length; i++) {
                    if(links[i].href.indexOf('#disqus_thread') >= 0) {
                        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
                    }
                }
                document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/oolai/get_num_replies.js' + query + '"></' + 'script>');
            })();
        </script>
    
<!-- BEGIN TUMBLR CODE --><iframe id="tumblr_controls" width="1" height="1" frameborder="0" scrolling="no" style="position:absolute; z-index:2147483647; top:0; right:0; border:0; background-color:transparent; overflow:hidden; " src="http://assets.tumblr.com/assets/html/iframe/o.html?_v=7f3ccc52344f6f4db744590e355db381#src=http%3A%2F%2Fkracekumar.com%2Fpost%2F47806200096%2Fhardest-feature-request&amp;pid=47806200096&amp;rk=ULmocIqZ&amp;lang=en_US&amp;name=kracekumar&amp;avatar=http%3A%2F%2F31.media.tumblr.com%2Favatar_08684c9830f1_64.png&amp;title=Random+stream&amp;url=http%3A%2F%2Fkracekumar.com%2F&amp;page_slide=slide"></iframe><div id="teaser_iframe_container" style="display:none;"><iframe scrolling="no" frameborder="0" src="http://www.tumblr.com/assets/html/iframe/teaser.html#src=http%3A%2F%2Fkracekumar.com%2Fpost%2F47806200096%2Fhardest-feature-request&amp;pid=47806200096&amp;rk=ULmocIqZ&amp;lang=en_US&amp;name=kracekumar&amp;avatar=http%3A%2F%2F31.media.tumblr.com%2Favatar_08684c9830f1_64.png&amp;title=Random+stream&amp;url=http%3A%2F%2Fkracekumar.com%2F&amp;page_slide=slide" id="teaser_iframe" width="1" height="1"></iframe></div><script type="text/javascript">
    (function(Tumblr){
        var follow_iframe_initialized = false;
        if (Tumblr.FollowTeaser && Tumblr.PostMessageListener) {
            // Don't do anything until the first initialize event
            Tumblr.PostMessageListener.initialize(function(message, origin) {
                if (follow_iframe_initialized || message.length < 2) return;

                if (message[0] === 'follow_iframe' && message[1] === 'enable') {
                    Tumblr.FollowTeaser.current_page = 1;
                    Tumblr.FollowTeaser.infer_infinite_scroll = true;
                    Tumblr.FollowTeaser.create_from_tumblr_controls("http:\/\/assets.tumblr.com\/assets\/html\/iframe\/follow.html?_v=5e68f8079f31e083bf6f7ba6a7b4a52a");
                    Tumblr.FollowTeaser.scroll_listener(true);
                    follow_iframe_initialized = true;
                }
            });
        }
    })(this.Tumblr || (this.Tumblr = {}));
</script><!--[if IE]><script type="text/javascript">document.getElementById('tumblr_controls').allowTransparency=true;</script><![endif]--><iframe onload="javascript:this.contentWindow.postMessage(['tick_google_analytics', '/post/47806200096/hardest-feature-request?route=%2Fpost%2F%3Aid%2F%3Asummary'].join(';'), this.src.split('/analytics.html')[0]);  COMSCORE = true;this.contentWindow.postMessage('enable_comscore;' + window.location, this.src.split('/analytics.html')[0]);" src="http://assets.tumblr.com/analytics.html?dfe9b9d3e783ff1f12fd8ce1b733bdc0" scrolling="no" width="1" height="1" frameborder="0" style="background-color:transparent; overflow:hidden; position:absolute; top:0; left:0 z-index:9999;" id="ga_target"></iframe><script type="text/javascript">
      var _qevents = _qevents || [];

      (function() {
       var elem = document.createElement('script');

       elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
       elem.async = true;
       elem.type = "text/javascript";
       var scpt = document.getElementsByTagName('script')[0];
       scpt.parentNode.insertBefore(elem, scpt);
      })();
    </script><script type="text/javascript">
        _qevents.push( { qacct: 'p-19UtqE8ngoZbM' } );
    </script><noscript><div style="display: none;"><img src="//pixel.quantserve.com/pixel/'p-19UtqE8ngoZbM'.gif" height="1" width="1" alt="Quantcast"/></div></noscript><script type="text/javascript">!function(s){s.src='http://www.tumblr.com/impixu?T=1386440530&J=eyJ0eXBlIjoidXJsIiwidXJsIjoiaHR0cDpcL1wva3JhY2VrdW1hci5jb21cL3Bvc3RcLzQ3ODA2MjAwMDk2XC9oYXJkZXN0LWZlYXR1cmUtcmVxdWVzdCIsInJlcXR5cGUiOjAsInJvdXRlIjoiXC9wb3N0XC86aWRcLzpzdW1tYXJ5In0=&U=KLNEHGPPHK&K=8983fe6256c73e24813088719905982ff7fdd1169c5e3b6943192113402fe616&R='.replace(/&R=[^&$]*/,'').concat('&R='+escape(document.referrer)).slice(0,2000).replace(/%.?.?$/,'');}(new Image());</script><noscript><img style="position:absolute;z-index:-3334;top:0px;left:0px;visibility:hidden;" src="http://www.tumblr.com/impixu?T=1386440530&J=eyJ0eXBlIjoidXJsIiwidXJsIjoiaHR0cDpcL1wva3JhY2VrdW1hci5jb21cL3Bvc3RcLzQ3ODA2MjAwMDk2XC9oYXJkZXN0LWZlYXR1cmUtcmVxdWVzdCIsInJlcXR5cGUiOjAsInJvdXRlIjoiXC9wb3N0XC86aWRcLzpzdW1tYXJ5Iiwibm9zY3JpcHQiOjF9&U=KLNEHGPPHK&K=96beb5a24825e9b9547600ab5a8cc7af937375c27879aa5a71917c1f83e9f5d4&R="></noscript><script type="text/javascript">!function(s){s.src='http://www.tumblr.com/impixu?T=1386440530&J=eyJ0eXBlIjoicG9zdCIsInVybCI6Imh0dHA6XC9cL2tyYWNla3VtYXIuY29tXC9wb3N0XC80NzgwNjIwMDA5NlwvaGFyZGVzdC1mZWF0dXJlLXJlcXVlc3QiLCJyZXF0eXBlIjowLCJyb3V0ZSI6IlwvcG9zdFwvOmlkXC86c3VtbWFyeSIsInBvc3RzIjpbeyJwb3N0aWQiOiI0NzgwNjIwMDA5NiIsImJsb2dpZCI6IjU2NTExMDgiLCJzb3VyY2UiOjMzfV19&U=KDMJKOKPAH&K=26918b591b94be0403af9120e60079a47cb3170ffb512c595f283e5ea34ecb2b&R='.replace(/&R=[^&$]*/,'').concat('&R='+escape(document.referrer)).slice(0,2000).replace(/%.?.?$/,'');}(new Image());</script><noscript><img style="position:absolute;z-index:-3334;top:0px;left:0px;visibility:hidden;" src="http://www.tumblr.com/impixu?T=1386440530&J=eyJ0eXBlIjoicG9zdCIsInVybCI6Imh0dHA6XC9cL2tyYWNla3VtYXIuY29tXC9wb3N0XC80NzgwNjIwMDA5NlwvaGFyZGVzdC1mZWF0dXJlLXJlcXVlc3QiLCJyZXF0eXBlIjowLCJyb3V0ZSI6IlwvcG9zdFwvOmlkXC86c3VtbWFyeSIsInBvc3RzIjpbeyJwb3N0aWQiOiI0NzgwNjIwMDA5NiIsImJsb2dpZCI6IjU2NTExMDgiLCJzb3VyY2UiOjMzfV0sIm5vc2NyaXB0IjoxfQ==&U=KDMJKOKPAH&K=f61a61d4987432747210bf47109bdf7c13c8d1f4330e6aa195013852529299cb&R="></noscript><script type="text/javascript" src="http://l.yimg.com/ss/rapid-3.9.js"></script><script>
                    (function(YAHOO) {
                        if (YAHOO) {
                            YAHOO.i13n.beacon_server = 'nol.yahoo.com';
                            var keys = { pd:'/post/:id/:summary', _li:0, i_rad:0, i_strm:0 };
                            YAHOO.rapid = new YAHOO.i13n.Rapid({spaceid:1197719230, oo:1, client_only:1, yql_enabled:false, keys:keys});
                        }
                    })(window.YAHOO);
                </script><!-- END TUMBLR CODE -->

</body>
</html>